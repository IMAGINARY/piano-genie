{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/main.js","js/original_script.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","_original_script","document","querySelector","addEventListener","showMainScreen","hidden","onKeyDown","controls","doTouchStart","passive","doTouchEnd","window","event","doTouchMove","canvas","mouseDownButton","radioMidiOutYes","player","usingMidiOut","midiOutBox","radioAudioYes","radioMidiInYes","usingMidiIn","midiInBox","isUsingMakey","updateButtonText","radioDeviceYes","radioMakeyYes","navigator","requestMIDIAccess","midiNotSupported","parentElement","removeAttribute","then","midi","midiReady","err","console","log","setAttribute","onKeyUp","genie","nextFromKeyWhitelist","keyWhitelist","TEMPERATURE","resetState","CONSTANTS","COLORS","NUM_BUTTONS","NOTES_PER_OCTAVE","WHITE_NOTES_PER_OCTAVE","LOWEST_PIANO_KEY_MIDI_NOTE","GENIE_CHECKPOINT","Player","_classCallCheck","this","mm","SoundFontPlayer","midiOut","midiIn","selectOutElement","getElementById","selectInElement","loadAllSamples","seq","notes","OCTAVES","push","pitch","loadSamples","button","sendMidiNoteOn","tone","context","resume","playNoteDown","sendMidiNoteOff","playNoteUp","_this","initDevices","target","_this2","outputs","values","output","next","done","value","inputs","input","onmidimessage","msg","getMIDIMessage","innerHTML","map","device","concat","name","join","selectedIndex","send","command","data","buttonDown","buttonUp","FloatyNotes","getContext","lineWidth","lineCap","contextHeight","whiteNoteHeight","width","innerWidth","height","innerHeight","x","noteToPaint","parseFloat","y","color","on","_this3","clearRect","filter","note","globalAlpha","fillStyle","fillRect","requestAnimationFrame","drawLoop","Piano","config","whiteNoteWidth","blackNoteWidth","blackNoteHeight","svg","svgNS","totalWhiteNotes","ratio","Math","floor","halfABlackNote","index","blackNoteIndexes","makeRect","indexOf","_o","_i","rect","w","h","fill","stroke","createElementNS","appendChild","MAPPING_8","0","2","3","4","5","6","7","MAPPING_4","BUTTONS_DEVICE","BUTTONS_MAKEY","BUTTONS_MAKEY_DISPLAY","BUTTON_MAPPING","getTemperature","heldButtonToVisualData","Map","sustaining","sustainingNotes","PianoGenie","painter","piano","updateNumButtons","num","buttons","querySelectorAll","preventDefault","dataset","id","down","el","has","highlightNote","addNote","getAttribute","set","thing","get","clearNote","stopNote","repeat","key","getButtonFromKeyCode","forEach","onWindowResize","bonusNotes","totalNotes","Array","resize","draw","String","parseInt","hash","params","location","substring","split","hk","temp","newTemp","min","btns","initialize","playBtn","textContent","classList","remove","checked"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import { showMainScreen } from './original_script';\n\ndocument.querySelector('#playBtn').addEventListener('click', () => {\n  showMainScreen();\n});\n","const CONSTANTS = {\n  COLORS : ['#EE2B29','#ff9800','#ffff00','#c6ff00','#00e5ff','#2979ff','#651fff','#d500f9'],\n  NUM_BUTTONS : 8,\n  NOTES_PER_OCTAVE : 12,\n  WHITE_NOTES_PER_OCTAVE : 7,\n  LOWEST_PIANO_KEY_MIDI_NOTE : 21,\n  GENIE_CHECKPOINT : 'model/genie',\n}\n\n/*************************\n * MIDI or Magenta player\n ************************/\nclass Player {\n  constructor() {\n    this.player = new mm.SoundFontPlayer('vendor/sgm_plus');\n    this.midiOut = [];\n    this.midiIn = []\n    this.usingMidiOut = false;\n    this.usingMidiIn = false;\n    this.selectOutElement = document.getElementById('selectOut');\n    this.selectInElement = document.getElementById('selectIn');\n    this.loadAllSamples();\n  }\n\n  loadAllSamples() {\n    const seq = {notes:[]};\n    for (let i = 0; i < CONSTANTS.NOTES_PER_OCTAVE * OCTAVES; i++) {\n      seq.notes.push({pitch: CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + i});\n    }\n    this.player.loadSamples(seq);\n  }\n\n  playNoteDown(pitch, button) {\n    // Send to MIDI out or play with the Magenta player.\n    if (this.usingMidiOut) {\n      this.sendMidiNoteOn(pitch, button);\n    } else {\n      mm.Player.tone.context.resume();\n      this.player.playNoteDown({pitch:pitch});\n    }\n  }\n\n  playNoteUp(pitch, button) {\n    // Send to MIDI out or play with the Magenta player.\n    if (this.usingMidiOut) {\n      this.sendMidiNoteOff(pitch, button);\n    } else {\n      this.player.playNoteUp({pitch:pitch});\n    }\n  }\n\n  // MIDI bits.\n  midiReady(midi) {\n    // Also react to device changes.\n    midi.addEventListener('statechange', (event) => this.initDevices(event.target));\n    this.initDevices(midi);\n  }\n\n  initDevices(midi) {\n    this.midiOut = [];\n    this.midiIn = [];\n\n\n    const outputs = midi.outputs.values();\n    for (let output = outputs.next(); output && !output.done; output = outputs.next()) {\n      this.midiOut.push(output.value);\n    }\n\n    const inputs = midi.inputs.values();\n    for (let input = inputs.next(); input && !input.done; input = inputs.next()) {\n      this.midiIn.push(input.value);\n      // TODO: should probably use the selected index from this.selectInElement for correctness\n      // but i'm hacking this together for a demo so...\n      input.value.onmidimessage = (msg) => this.getMIDIMessage(msg);\n\n    }\n\n    // No MIDI, no settings.\n    //btnSettings.hidden = (this.midiOut.length === 0 && this.midiIn.length === 0);\n    this.selectInElement.innerHTML = this.midiIn.map(device => `<option>${device.name}</option>`).join('');\n    this.selectOutElement.innerHTML = this.midiOut.map(device => `<option>${device.name}</option>`).join('');\n  }\n\n  sendMidiNoteOn(pitch, button) {\n    // -1 is sent when releasing the sustain pedal.\n    if (button === -1) button = 0;\n    //const msg = [0x90 + button, pitch, 0x7f];    // note on, full velocity.\n    const msg = [0x90, pitch, 0x7f];    // note on, full velocity.\n    this.midiOut[this.selectOutElement.selectedIndex].send(msg);\n  }\n\n  sendMidiNoteOff(pitch, button) {\n    // -1 is sent when releasing the sustain pedal.\n    if (button === -1) button = 0;\n    //const msg = [0x80 + button, pitch, 0x7f];    // note on, middle C, full velocity.\n    const msg = [0x80, pitch, 0x7f];    // note on, middle C, full velocity.\n    this.midiOut[this.selectOutElement.selectedIndex].send(msg);\n  }\n\n  getMIDIMessage(msg) {\n    if (!this.usingMidiIn) {\n      return;\n    }\n    const command = msg.data[0];\n    const button = msg.data[1];\n    const velocity = (msg.data.length > 2) ? msg.data[2] : 0; // a velocity value might not be included with a noteOff command\n\n    switch (command) {\n      case 0x90: // note on\n        buttonDown(button, false);\n        break;\n      case 0x80: // note off\n        buttonUp(button);\n        break;\n    }\n  }\n}\n\n/*************************\n * Floaty notes\n ************************/\nclass FloatyNotes {\n  constructor() {\n    this.notes = [];  // the notes floating on the screen.\n\n    this.canvas = document.getElementById('canvas')\n    this.context = this.canvas.getContext('2d');\n    this.context.lineWidth = 4;\n    this.context.lineCap = 'round';\n\n    this.contextHeight = 0;\n  }\n\n  resize(whiteNoteHeight) {\n    this.canvas.width = window.innerWidth;\n    this.canvas.height = this.contextHeight = window.innerHeight - whiteNoteHeight - 20;\n  }\n\n  addNote(button, x, width) {\n    const noteToPaint = {\n      x: parseFloat(x),\n      y: 0,\n      width: parseFloat(width),\n      height: 0,\n      color: CONSTANTS.COLORS[button],\n      on: true\n    };\n    this.notes.push(noteToPaint);\n    return noteToPaint;\n  }\n\n  stopNote(noteToPaint) {\n    noteToPaint.on = false;\n  }\n\n  drawLoop() {\n    const dy = 3;\n    this.context.clearRect(0, 0, window.innerWidth, window.innerHeight);\n\n    // Remove all the notes that will be off the page;\n    this.notes = this.notes.filter((note) => note.on || note.y < (this.contextHeight - 100));\n\n    // Advance all the notes.\n    for (let i = 0; i < this.notes.length; i++) {\n      const note = this.notes[i];\n\n      // If the note is still on, then its height goes up but it\n      // doesn't start sliding down yet.\n      if (note.on) {\n        note.height += dy;\n      } else {\n        note.y += dy;\n      }\n\n      this.context.globalAlpha = 1 - note.y / this.contextHeight;\n      this.context.fillStyle = note.color;\n      this.context.fillRect(note.x, note.y, note.width, note.height);\n    }\n    window.requestAnimationFrame(() => this.drawLoop());\n  }\n}\n\nclass Piano {\n  constructor() {\n    this.config = {\n      whiteNoteWidth: 20,\n      blackNoteWidth: 20,\n      whiteNoteHeight: 70,\n      blackNoteHeight: 2 * 70 / 3\n    }\n\n    this.svg = document.getElementById('svg');\n    this.svgNS = 'http://www.w3.org/2000/svg';\n  }\n\n  resize(totalWhiteNotes) {\n    // i honestly don't know why some flooring is good and some is bad sigh.\n    const ratio = window.innerWidth / totalWhiteNotes;\n    this.config.whiteNoteWidth = OCTAVES > 6 ? ratio: Math.floor(ratio);\n    this.config.blackNoteWidth = this.config.whiteNoteWidth * 2 / 3;\n    this.svg.setAttribute('width', window.innerWidth);\n    this.svg.setAttribute('height', this.config.whiteNoteHeight);\n  }\n\n  draw() {\n    this.svg.innerHTML = '';\n    const halfABlackNote = this.config.blackNoteWidth / 2;\n    let x = 0;\n    let y = 0;\n    let index = 0;\n\n    const blackNoteIndexes = [1, 3, 6, 8, 10];\n\n    // First draw all the white notes.\n    // Pianos start on an A (if we're using all the octaves);\n    if (OCTAVES > 6) {\n      this.makeRect(0, x, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n      this.makeRect(2, this.config.whiteNoteWidth, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n      index = 3;\n      x = 2 * this.config.whiteNoteWidth;\n    } else {\n      // Starting 3 semitones up on small screens (on a C), and a whole octave up.\n      index = 3 + CONSTANTS.NOTES_PER_OCTAVE;\n    }\n\n    // Draw the white notes.\n    for (let o = 0; o < OCTAVES; o++) {\n      for (let i = 0; i < CONSTANTS.NOTES_PER_OCTAVE; i++) {\n        if (blackNoteIndexes.indexOf(i) === -1) {\n          this.makeRect(index, x, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n          x += this.config.whiteNoteWidth;\n        }\n        index++;\n      }\n    }\n\n    if (OCTAVES > 6) {\n      // And an extra C at the end (if we're using all the octaves);\n      this.makeRect(index, x, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n\n      // Now draw all the black notes, so that they sit on top.\n      // Pianos start on an A:\n      this.makeRect(1, this.config.whiteNoteWidth - halfABlackNote, y, this.config.blackNoteWidth, this.config.blackNoteHeight, 'black');\n      index = 3;\n      x = this.config.whiteNoteWidth;\n    } else {\n      // Starting 3 semitones up on small screens (on a C), and a whole octave up.\n      index = 3 + CONSTANTS.NOTES_PER_OCTAVE;\n      x = -this.config.whiteNoteWidth;\n    }\n\n    // Draw the black notes.\n    for (let o = 0; o < OCTAVES; o++) {\n      for (let i = 0; i < CONSTANTS.NOTES_PER_OCTAVE; i++) {\n        if (blackNoteIndexes.indexOf(i) !== -1) {\n          this.makeRect(index, x + this.config.whiteNoteWidth - halfABlackNote, y, this.config.blackNoteWidth, this.config.blackNoteHeight, 'black');\n        } else {\n          x += this.config.whiteNoteWidth;\n        }\n        index++;\n      }\n    }\n  }\n\n  highlightNote(note, button) {\n    // Show the note on the piano roll.\n    const rect = this.svg.querySelector(`rect[data-index=\"${note}\"]`);\n    if (!rect) {\n      console.log('couldnt find a rect for note', note);\n      return;\n    }\n    rect.setAttribute('active', true);\n    rect.setAttribute('class', `color-${button}`);\n    return rect;\n  }\n\n  clearNote(rect) {\n    rect.removeAttribute('active');\n    rect.removeAttribute('class');\n  }\n\n  makeRect(index, x, y, w, h, fill, stroke) {\n    const rect = document.createElementNS(this.svgNS, 'rect');\n    rect.setAttribute('data-index', index);\n    rect.setAttribute('x', x);\n    rect.setAttribute('y', y);\n    rect.setAttribute('width', w);\n    rect.setAttribute('height', h);\n    rect.setAttribute('fill', fill);\n    if (stroke) {\n      rect.setAttribute('stroke', stroke);\n      rect.setAttribute('stroke-width', '3px');\n    }\n    this.svg.appendChild(rect);\n    return rect;\n  }\n}\n\n/*************************\n * Consts for everyone!\n ************************/\n// button mappings.\nconst MAPPING_8 = {0:0, 1:1, 2:2, 3:3, 4:4, 5:5, 6:6, 7:7};\nconst MAPPING_4 = {0:0, 1:2, 2:5, 3:7};\nconst BUTTONS_DEVICE = ['a','s','d','f','j','k','l',';'];\nconst BUTTONS_MAKEY = ['ArrowUp','ArrowLeft','ArrowDown','ArrowRight','w','a','s','d'];\nconst BUTTONS_MAKEY_DISPLAY = ['↑','←','↓','→','w','a','s','d'];\n\nlet OCTAVES = 7;\nlet NUM_BUTTONS = 8;\nlet BUTTON_MAPPING = MAPPING_8;\n\nlet keyWhitelist;\nlet TEMPERATURE = getTemperature();\n\nconst heldButtonToVisualData = new Map();\n\n// Which notes the pedal is sustaining.\nlet sustaining = false\nlet sustainingNotes = [];\n\n// Mousedown/up events are weird because you can mouse down in one element and mouse up\n// in another, so you're going to lose that original element and never mouse it up.\nlet mouseDownButton = null;\n\nconst player = new Player();\nconst genie = new mm.PianoGenie(CONSTANTS.GENIE_CHECKPOINT);\nconst painter = new FloatyNotes();\nconst piano = new Piano();\nlet isUsingMakey = false;\ninitEverything();\n\n/*************************\n * Basic UI bits\n ************************/\nfunction initEverything() {\n  genie.initialize().then(() => {\n    console.log('🧞‍♀️ ready!');\n    playBtn.textContent = 'Play';\n    playBtn.removeAttribute('disabled');\n    playBtn.classList.remove('loading');\n  });\n\n  // Start the drawing loop.\n  onWindowResize();\n  updateButtonText();\n  window.requestAnimationFrame(() => painter.drawLoop());\n\n  // Event listeners.\n  document.getElementById('numButtons4').addEventListener('change', (event) => event.target.checked && updateNumButtons(4));\n  document.getElementById('numButtons8').addEventListener('change', (event) => event.target.checked && updateNumButtons(8));\n\n  window.addEventListener('resize', onWindowResize);\n  window.addEventListener('orientationchange', onWindowResize);\n  window.addEventListener('hashchange', () => TEMPERATURE = getTemperature());\n}\n\nfunction updateNumButtons(num) {\n  NUM_BUTTONS = num;\n  const buttons = document.querySelectorAll('.controls > button.color');\n  BUTTON_MAPPING = (num === 4) ? MAPPING_4 : MAPPING_8;\n\n  // Hide the extra buttons.\n  for (let i = 0; i < buttons.length; i++) {\n    buttons[i].hidden = i >= num;\n  }\n}\n\nexport function showMainScreen() {\n  document.querySelector('.splash').hidden = true;\n  document.querySelector('.loaded').hidden = false;\n\n  document.addEventListener('keydown',onKeyDown);\n\n  controls.addEventListener('touchstart', (event) => doTouchStart(event), {passive: true});\n  controls.addEventListener('touchend', (event) => doTouchEnd(event), {passive: true});\n\n  const hasTouchEvents = ('ontouchstart' in window);\n  if (!hasTouchEvents) {\n    controls.addEventListener('mousedown', (event) => doTouchStart(event));\n    controls.addEventListener('mouseup', (event) => doTouchEnd(event));\n  }\n\n  controls.addEventListener('mouseover', (event) => doTouchMove(event, true));\n  controls.addEventListener('mouseout', (event) => doTouchMove(event, false));\n  controls.addEventListener('touchenter', (event) => doTouchMove(event, true));\n  controls.addEventListener('touchleave', (event) => doTouchMove(event, false));\n  canvas.addEventListener('mouseenter', () => mouseDownButton = null);\n\n  // Output.\n  radioMidiOutYes.addEventListener('click', () => {\n    player.usingMidiOut = true;\n    midiOutBox.hidden = false;\n  });\n  radioAudioYes.addEventListener('click', () => {\n    player.usingMidiOut = false;\n    midiOutBox.hidden = true;\n  });\n  // Input.\n  radioMidiInYes.addEventListener('click', () => {\n    player.usingMidiIn = true;\n    midiInBox.hidden = false;\n    isUsingMakey = false;\n    updateButtonText();\n  });\n  radioDeviceYes.addEventListener('click', () => {\n    player.usingMidiIn = false;\n    midiInBox.hidden = true;\n    isUsingMakey = false;\n    updateButtonText();\n  });\n  radioMakeyYes.addEventListener('click', () => {\n    player.usingMidiIn = false;\n    midiInBox.hidden = true;\n    isUsingMakey = true;\n    updateButtonText();\n  });\n\n  // Figure out if WebMidi works.\n  if (navigator.requestMIDIAccess) {\n    midiNotSupported.hidden = true;\n    radioMidiInYes.parentElement.removeAttribute('disabled');\n    radioMidiOutYes.parentElement.removeAttribute('disabled');\n    navigator.requestMIDIAccess()\n      .then(\n          (midi) => player.midiReady(midi),\n          (err) => console.log('Something went wrong', err));\n  } else {\n    midiNotSupported.hidden = false;\n    radioMidiInYes.parentElement.setAttribute('disabled', true);\n    radioMidiOutYes.parentElement.setAttribute('disabled', true);\n  }\n\n  document.addEventListener('keyup', onKeyUp);\n\n  // Slow to start up, so do a fake prediction to warm up the model.\n  const note = genie.nextFromKeyWhitelist(0, keyWhitelist, TEMPERATURE);\n  genie.resetState();\n}\n\n// Here touch means either touch or mouse.\nfunction doTouchStart(event) {\n  event.preventDefault();\n  mouseDownButton = event.target;\n  buttonDown(event.target.dataset.id, true);\n}\nfunction doTouchEnd(event) {\n  event.preventDefault();\n  if (mouseDownButton && mouseDownButton !== event.target) {\n    buttonUp(mouseDownButton.dataset.id);\n  }\n  mouseDownButton = null;\n  buttonUp(event.target.dataset.id);\n}\nfunction doTouchMove(event, down) {\n   // If we're already holding a button down, start holding this one too.\n  if (!mouseDownButton)\n    return;\n\n  if (down)\n    buttonDown(event.target.dataset.id, true);\n  else\n    buttonUp(event.target.dataset.id, true);\n}\n\n/*************************\n * Button actions\n ************************/\nfunction buttonDown(button, fromKeyDown) {\n  // If we're already holding this button down, nothing new to do.\n  if (heldButtonToVisualData.has(button)) {\n    return;\n  }\n\n  const el = document.getElementById(`btn${button}`);\n  if (!el)\n    return;\n  el.setAttribute('active', true);\n\n  const note = genie.nextFromKeyWhitelist(BUTTON_MAPPING[button], keyWhitelist, TEMPERATURE);\n  const pitch = CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + note;\n\n  // Hear it.\n  player.playNoteDown(pitch, button);\n\n  // See it.\n  const rect = piano.highlightNote(note, button);\n\n  if (!rect) {\n    debugger;\n  }\n  // Float it.\n  const noteToPaint = painter.addNote(button, rect.getAttribute('x'), rect.getAttribute('width'));\n  heldButtonToVisualData.set(button, {rect:rect, note:note, noteToPaint:noteToPaint});\n}\n\nfunction buttonUp(button) {\n  const el = document.getElementById(`btn${button}`);\n  if (!el)\n    return;\n  el.removeAttribute('active');\n\n  const thing = heldButtonToVisualData.get(button);\n  if (thing) {\n    // Don't see it.\n    piano.clearNote(thing.rect);\n\n    // Stop holding it down.\n    painter.stopNote(thing.noteToPaint);\n\n    // Maybe stop hearing it.\n    const pitch = CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + thing.note;\n    if (!sustaining) {\n      player.playNoteUp(pitch, button);\n    } else {\n      sustainingNotes.push(CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + thing.note);\n    }\n  }\n  heldButtonToVisualData.delete(button);\n}\n\n/*************************\n * Events\n ************************/\nfunction onKeyDown(event) {\n  // Keydown fires continuously and we don't want that.\n  if (event.repeat) {\n    return;\n  }\n  if (event.key === ' ') {  // sustain pedal\n    sustaining = true;\n  } else if (event.key === '0' || event.key === 'r') {\n    console.log('🧞‍♀️ resetting!');\n    genie.resetState();\n  } else {\n    const button = getButtonFromKeyCode(event.key);\n    if (button != null) {\n      buttonDown(button, true);\n    }\n  }\n}\n\nfunction onKeyUp(event) {\n  if (event.key === ' ') {  // sustain pedal\n    sustaining = false;\n\n    // Release everything.\n    sustainingNotes.forEach((note) => player.playNoteUp(note, -1));\n    sustainingNotes = [];\n  } else {\n    const button = getButtonFromKeyCode(event.key);\n    if (button != null) {\n      buttonUp(button);\n    }\n  }\n}\n\nfunction onWindowResize() {\n  OCTAVES = window.innerWidth > 700 ? 7 : 3;\n  const bonusNotes = OCTAVES > 6 ? 4 : 0;  // starts on an A, ends on a C.\n  const totalNotes = CONSTANTS.NOTES_PER_OCTAVE * OCTAVES + bonusNotes;\n  const totalWhiteNotes = CONSTANTS.WHITE_NOTES_PER_OCTAVE * OCTAVES + (bonusNotes - 1);\n  keyWhitelist = Array(totalNotes).fill().map((x,i) => {\n    if (OCTAVES > 6) return i;\n    // Starting 3 semitones up on small screens (on a C), and a whole octave up.\n    return i + 3 + CONSTANTS.NOTES_PER_OCTAVE;\n  });\n\n  piano.resize(totalWhiteNotes);\n  painter.resize(piano.config.whiteNoteHeight);\n  piano.draw();\n}\n\n/*************************\n * Utils and helpers\n ************************/\nfunction getButtonFromKeyCode(key) {\n  // 1 - 8\n  if (key >= '1' && key <= String(NUM_BUTTONS)) {\n    return parseInt(key) - 1;\n  }\n\n  const index = isUsingMakey ? BUTTONS_MAKEY.indexOf(key) : BUTTONS_DEVICE.indexOf(key);\n  return index !== -1 ? index : null;\n}\n\nfunction getTemperature() {\n  const hash = parseFloat(parseHashParameters()['temperature']) || 0.25;\n  const newTemp = Math.min(1, hash);\n  console.log('🧞‍♀️ temperature = ', newTemp);\n  return newTemp;\n}\n\nfunction parseHashParameters() {\n  const hash = window.location.hash.substring(1);\n  const params = {}\n  hash.split('&').map(hk => {\n    let temp = hk.split('=');\n    params[temp[0]] = temp[1]\n  });\n  return params;\n}\n\nfunction updateButtonText() {\n  const btns = document.querySelectorAll('.controls button.color');\n  for (let i = 0; i < btns.length; i++) {\n    btns[i].innerHTML = isUsingMakey ?\n        `<span>${BUTTONS_MAKEY_DISPLAY[i]}</span>` :\n        `<span>${i + 1}</span><br><span>${BUTTONS_DEVICE[i]}</span>`;\n  }\n}\n"]}