{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/main.js","js/piano-genie.js","node_modules/qs/lib/formats.js","node_modules/qs/lib/index.js","node_modules/qs/lib/parse.js","node_modules/qs/lib/stringify.js","node_modules/qs/lib/utils.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","_qs","_pianoGenie","_main","defaultConfig","defaultLanguage","showInfoButton","showConfigButton","showFullScreenButton","showInputKeys","showInputInstructions","keyCount","input","output","loadConfig","_callee2","uri","response","regeneratorRuntime","wrap","_context2","prev","next","fetch","sent","status","json","abrupt","t0","concat","message","statusText","stop","_asyncToGenerator","mark","_callee","config","_context","Object","t1","t2","t3","assign","undefined","parse","window","location","search","ignoreQueryPrefix","embed","embedMode","IMAGINARY","i18n","init","queryStringVariable","translationsDirectory","initPianoGenie","document","querySelectorAll","forEach","element","innerHTML","getAttribute","t4","console","error","apply","this","arguments","options","CONSTANTS","COLORS","NUM_BUTTONS","NOTES_PER_OCTAVE","WHITE_NOTES_PER_OCTAVE","LOWEST_PIANO_KEY_MIDI_NOTE","NUM_NOTES","GENIE_CHECKPOINT","Player","_classCallCheck","player","mm","SoundFontPlayer","midiOut","midiIn","usingMidiOut","usingMidiIn","selectOutElement","getElementById","selectInElement","loadAllSamples","_createClass","key","value","seq","notes","push","pitch","loadSamples","button","sendMidiNoteOn","tone","context","resume","playNoteDown","sendMidiNoteOff","playNoteUp","midi","_this","addEventListener","event","initDevices","target","_this2","outputs","values","done","inputs","onmidimessage","msg","getMIDIMessage","map","device","name","join","selectedIndex","send","command","data","buttonDown","buttonUp","FloatyNotes","canvas","getContext","lineWidth","lineCap","contextHeight","whiteNoteHeight","width","innerWidth","height","innerHeight","x","noteToPaint","parseFloat","y","color","on","_this3","clearRect","filter","note","globalAlpha","fillStyle","fillRect","requestAnimationFrame","drawLoop","Piano","whiteNoteWidth","blackNoteWidth","blackNoteHeight","svg","svgNS","totalWhiteNotes","ratio","OCTAVES","Math","floor","setAttribute","halfABlackNote","index","blackNoteIndexes","makeRect","indexOf","_o","_i","rect","querySelector","log","removeAttribute","w","h","fill","stroke","createElementNS","appendChild","showFocusTip","classList","add","keyWhitelist","MAPPING_8","0","2","3","4","5","6","7","MAPPING_4","KEYCODES_NUMBERS","KEYCODES_STD","KEYCODES_MAKEY","BUTTON_MAPPING","TEMPERATURE","getTemperature","heldButtonToVisualData","Map","sustaining","sustainingNotes","mouseDownButton","genie","PianoGenie","painter","piano","isUsingMakey","updateNumButtons","num","buttons","hidden","doTouchStart","preventDefault","dataset","id","doTouchEnd","doTouchMove","down","el","has","nextFromKeyWhitelist","highlightNote","addNote","set","thing","get","clearNote","stopNote","onKeyDown","repeat","resetState","getButtonFromKeyCode","onKeyUp","onWindowResize","bonusNotes","totalNotes","Array","resize","draw","hash","params","substring","split","hk","temp","newTemp","min","updateButtonText","btns","display","showInputKeysText","style","initialize","then","controls","passive","radioMidiOutYes","midiOutBox","radioAudioYes","click","radioMidiInYes","midiInBox","radioDeviceYes","radioMakeyYes","navigator","requestMIDIAccess","midiNotSupported","parentElement","midiReady","err","showMainScreen","checked","remove","hasFocus","infoBox","settingsBox","body","requestFullscreen","fullscreenElement","exitFullscreen","alert","replace","String","prototype","percentTwenties","util","Format","RFC1738","RFC3986","default","formatters","stringify","formats","parseArrayValue","val","comma","parseValues","str","part","bracketEqualsPos","pos","obj","cleanStr","limit","parameterLimit","Infinity","parts","delimiter","skipIndex","charset","charsetSentinel","decoder","defaults","strictNullHandling","slice","utils","maybeMap","encodedVal","interpretNumericEntities","$0","numberStr","fromCharCode","parseInt","isArray","combine","parseKeys","givenKey","valuesParsed","allowDots","child","segment","depth","exec","parent","keys","plainObjects","allowPrototypes","chain","leaf","cleanRoot","root","parseArrays","create","charAt","isNaN","arrayLimit","parseObject","hasOwnProperty","decode","opts","TypeError","isRegExp","normalizeParseOptions","tempObj","newObj","merge","compact","pushToArray","arr","valueOrArray","object","prefix","generateArrayPrefix","skipNulls","encoder","sort","serializeDate","formatter","encodeValuesOnly","v","Date","isBuffer","objKeys","keyPrefix","arrayPrefixGenerators","brackets","indices","toISO","toISOString","defaultFormat","addQueryPrefix","encode","format","date","normalizeStringifyOptions","arrayFormat","joined","arrayToObject","source","hexTable","array","toString","toUpperCase","reduce","acc","b","queue","prop","refs","item","j","pop","compacted","compactQueue","strWithoutPlus","unescape","decodeURIComponent","defaultEncoder","string","Symbol","escape","out","charCodeAt","constructor","fn","mapped","mergeTarget","targetItem"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/* globals IMAGINARY */\nimport qs from 'qs';\nimport { initPianoGenie } from './piano-genie';\n\nconst defaultConfig = {\n  defaultLanguage: 'en',\n  showInfoButton: true,\n  showConfigButton: true,\n  showFullScreenButton: true,\n  showInputKeys: true,\n  showInputInstructions: true,\n  keyCount: 8,\n  input: 'keyboard',\n  output: 'wave',\n};\n\n/**\n * Loads the config file from an external JSON file\n *\n * @param {String} uri\n * @return {Promise<any>}\n */\nasync function loadConfig(uri) {\n  const response = await fetch(uri);\n  if (response.status >= 200 && response.status < 300) {\n    try {\n      return await response.json();\n    } catch (e) {\n      throw new Error(`Error parsing config file: ${e.message}`);\n    }\n  }\n  throw new Error(`Server returned status ${response.status} (${response.statusText}) loading config file.`);\n}\n\n/**\n * Load config files and start the program\n */\n(async function main() {\n  try {\n    const config = Object.assign({}, defaultConfig, await loadConfig('./config.json'));\n    const qsArgs = qs.parse(window.location.search, { ignoreQueryPrefix: true });\n\n    if (qsArgs.embed !== undefined) {\n      config.embedMode = true;\n    }\n\n    await IMAGINARY.i18n.init({\n      queryStringVariable: 'lang',\n      translationsDirectory: 'tr',\n      defaultLanguage: config.defaultLanguage || 'en',\n    });\n\n    initPianoGenie(config);\n\n    document.querySelectorAll('[data-i18n-field]').forEach((element) => {\n      element.innerHTML = IMAGINARY.i18n.t(element.getAttribute('data-i18n-field'));\n    });\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n  }\n}());\n","/* globals IMAGINARY */\n\nexport function initPianoGenie(options) {\n\n  const CONSTANTS = {\n    COLORS : ['#db4c67','#ff8459','#ffec02','#73ff6c',\n      '#00c5ba','#3753be','#9c52ff','#ef71f2'],\n    NUM_BUTTONS : 8,\n    NOTES_PER_OCTAVE : 12,\n    WHITE_NOTES_PER_OCTAVE : 7,\n    LOWEST_PIANO_KEY_MIDI_NOTE : 21,\n    NUM_NOTES: 88,\n    GENIE_CHECKPOINT : 'model/genie',\n  }\n\n  /*************************\n   * MIDI or Magenta player\n   ************************/\n  class Player {\n    constructor() {\n      this.player = new mm.SoundFontPlayer('vendor/sgm_plus');\n      this.midiOut = [];\n      this.midiIn = []\n      this.usingMidiOut = false;\n      this.usingMidiIn = false;\n      this.selectOutElement = document.getElementById('selectOut');\n      this.selectInElement = document.getElementById('selectIn');\n      this.loadAllSamples();\n    }\n\n    loadAllSamples() {\n      const seq = {notes:[]};\n      for (let i = 0; i < CONSTANTS.NUM_NOTES; i++) {\n        seq.notes.push({pitch: CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + i});\n      }\n      this.player.loadSamples(seq);\n    }\n\n    playNoteDown(pitch, button) {\n      // Send to MIDI out or play with the Magenta player.\n      if (this.usingMidiOut) {\n        this.sendMidiNoteOn(pitch, button);\n      } else {\n        mm.Player.tone.context.resume();\n        this.player.playNoteDown({pitch:pitch});\n      }\n    }\n\n    playNoteUp(pitch, button) {\n      // Send to MIDI out or play with the Magenta player.\n      if (this.usingMidiOut) {\n        this.sendMidiNoteOff(pitch, button);\n      } else {\n        this.player.playNoteUp({pitch:pitch});\n      }\n    }\n\n    // MIDI bits.\n    midiReady(midi) {\n      // Also react to device changes.\n      midi.addEventListener('statechange', (event) => this.initDevices(event.target));\n      this.initDevices(midi);\n    }\n\n    initDevices(midi) {\n      this.midiOut = [];\n      this.midiIn = [];\n\n\n      const outputs = midi.outputs.values();\n      for (let output = outputs.next(); output && !output.done; output = outputs.next()) {\n        this.midiOut.push(output.value);\n      }\n\n      const inputs = midi.inputs.values();\n      for (let input = inputs.next(); input && !input.done; input = inputs.next()) {\n        this.midiIn.push(input.value);\n        // TODO: should probably use the selected index from this.selectInElement for correctness\n        // but i'm hacking this together for a demo so...\n        input.value.onmidimessage = (msg) => this.getMIDIMessage(msg);\n\n      }\n\n      // No MIDI, no settings.\n      //btnSettings.hidden = (this.midiOut.length === 0 && this.midiIn.length === 0);\n      this.selectInElement.innerHTML = this.midiIn.map(device => `<option>${device.name}</option>`).join('');\n      this.selectOutElement.innerHTML = this.midiOut.map(device => `<option>${device.name}</option>`).join('');\n    }\n\n    sendMidiNoteOn(pitch, button) {\n      // -1 is sent when releasing the sustain pedal.\n      if (button === -1) button = 0;\n      //const msg = [0x90 + button, pitch, 0x7f];    // note on, full velocity.\n      const msg = [0x90, pitch, 0x7f];    // note on, full velocity.\n      this.midiOut[this.selectOutElement.selectedIndex].send(msg);\n    }\n\n    sendMidiNoteOff(pitch, button) {\n      // -1 is sent when releasing the sustain pedal.\n      if (button === -1) button = 0;\n      //const msg = [0x80 + button, pitch, 0x7f];    // note on, middle C, full velocity.\n      const msg = [0x80, pitch, 0x7f];    // note on, middle C, full velocity.\n      this.midiOut[this.selectOutElement.selectedIndex].send(msg);\n    }\n\n    getMIDIMessage(msg) {\n      if (!this.usingMidiIn) {\n        return;\n      }\n      const command = msg.data[0];\n      const button = msg.data[1];\n      const velocity = (msg.data.length > 2) ? msg.data[2] : 0; // a velocity value might not be included with a noteOff command\n\n      switch (command) {\n        case 0x90: // note on\n          buttonDown(button, false);\n          break;\n        case 0x80: // note off\n          buttonUp(button);\n          break;\n      }\n    }\n  }\n\n  /*************************\n   * Floaty notes\n   ************************/\n  class FloatyNotes {\n    constructor() {\n      this.notes = [];  // the notes floating on the screen.\n\n      this.canvas = document.getElementById('canvas')\n      this.context = this.canvas.getContext('2d');\n      this.context.lineWidth = 4;\n      this.context.lineCap = 'round';\n\n      this.contextHeight = 0;\n    }\n\n    resize(whiteNoteHeight) {\n      this.canvas.width = window.innerWidth;\n      this.canvas.height = this.contextHeight = window.innerHeight - whiteNoteHeight - 20;\n    }\n\n    addNote(button, x, width) {\n      const noteToPaint = {\n        x: parseFloat(x),\n        y: 0,\n        width: parseFloat(width),\n        height: 0,\n        color: CONSTANTS.COLORS[button],\n        on: true\n      };\n      this.notes.push(noteToPaint);\n      return noteToPaint;\n    }\n\n    stopNote(noteToPaint) {\n      noteToPaint.on = false;\n    }\n\n    drawLoop() {\n      const dy = 3;\n      this.context.clearRect(0, 0, window.innerWidth, window.innerHeight);\n\n      // Remove all the notes that will be off the page;\n      this.notes = this.notes.filter((note) => note.on || note.y < (this.contextHeight - 100));\n\n      // Advance all the notes.\n      for (let i = 0; i < this.notes.length; i++) {\n        const note = this.notes[i];\n\n        // If the note is still on, then its height goes up but it\n        // doesn't start sliding down yet.\n        if (note.on) {\n          note.height += dy;\n        } else {\n          note.y += dy;\n        }\n\n        this.context.globalAlpha = 1 - note.y / this.contextHeight;\n        this.context.fillStyle = note.color;\n        this.context.fillRect(note.x, note.y, note.width, note.height);\n      }\n      window.requestAnimationFrame(() => this.drawLoop());\n    }\n  }\n\n  class Piano {\n    constructor() {\n      this.config = {\n        whiteNoteWidth: 20,\n        blackNoteWidth: 20,\n        whiteNoteHeight: 70,\n        blackNoteHeight: 2 * 70 / 3\n      }\n\n      this.svg = document.getElementById('svg');\n      this.svgNS = 'http://www.w3.org/2000/svg';\n    }\n\n    resize(totalWhiteNotes) {\n      // i honestly don't know why some flooring is good and some is bad sigh.\n      const ratio = window.innerWidth / totalWhiteNotes;\n      this.config.whiteNoteWidth = OCTAVES > 6 ? ratio: Math.floor(ratio);\n      this.config.blackNoteWidth = this.config.whiteNoteWidth * 2 / 3;\n      this.svg.setAttribute('width', window.innerWidth);\n      this.svg.setAttribute('height', this.config.whiteNoteHeight);\n    }\n\n    draw() {\n      this.svg.innerHTML = '';\n      const halfABlackNote = this.config.blackNoteWidth / 2;\n      let x = 0;\n      let y = 0;\n      let index = 0;\n\n      const blackNoteIndexes = [1, 3, 6, 8, 10];\n\n      // First draw all the white notes.\n      // Pianos start on an A (if we're using all the octaves);\n      if (OCTAVES > 6) {\n        this.makeRect(0, x, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n        this.makeRect(2, this.config.whiteNoteWidth, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n        index = 3;\n        x = 2 * this.config.whiteNoteWidth;\n      } else {\n        // Starting 3 semitones up on small screens (on a C), and a whole octave up.\n        index = 3 + CONSTANTS.NOTES_PER_OCTAVE;\n      }\n\n      // Draw the white notes.\n      for (let o = 0; o < OCTAVES; o++) {\n        for (let i = 0; i < CONSTANTS.NOTES_PER_OCTAVE; i++) {\n          if (blackNoteIndexes.indexOf(i) === -1) {\n            this.makeRect(index, x, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n            x += this.config.whiteNoteWidth;\n          }\n          index++;\n        }\n      }\n\n      if (OCTAVES > 6) {\n        // And an extra C at the end (if we're using all the octaves);\n        this.makeRect(index, x, y, this.config.whiteNoteWidth, this.config.whiteNoteHeight, 'white', '#141E30');\n\n        // Now draw all the black notes, so that they sit on top.\n        // Pianos start on an A:\n        this.makeRect(1, this.config.whiteNoteWidth - halfABlackNote, y, this.config.blackNoteWidth, this.config.blackNoteHeight, 'black');\n        index = 3;\n        x = this.config.whiteNoteWidth;\n      } else {\n        // Starting 3 semitones up on small screens (on a C), and a whole octave up.\n        index = 3 + CONSTANTS.NOTES_PER_OCTAVE;\n        x = -this.config.whiteNoteWidth;\n      }\n\n      // Draw the black notes.\n      for (let o = 0; o < OCTAVES; o++) {\n        for (let i = 0; i < CONSTANTS.NOTES_PER_OCTAVE; i++) {\n          if (blackNoteIndexes.indexOf(i) !== -1) {\n            this.makeRect(index, x + this.config.whiteNoteWidth - halfABlackNote, y, this.config.blackNoteWidth, this.config.blackNoteHeight, 'black');\n          } else {\n            x += this.config.whiteNoteWidth;\n          }\n          index++;\n        }\n      }\n    }\n\n    highlightNote(note, button) {\n      // Show the note on the piano roll.\n      const rect = this.svg.querySelector(`rect[data-index=\"${note}\"]`);\n      if (!rect) {\n        console.log('couldnt find a rect for note', note);\n        return;\n      }\n      rect.setAttribute('active', true);\n      rect.setAttribute('class', `color-${button}`);\n      return rect;\n    }\n\n    clearNote(rect) {\n      rect.removeAttribute('active');\n      rect.removeAttribute('class');\n    }\n\n    makeRect(index, x, y, w, h, fill, stroke) {\n      const rect = document.createElementNS(this.svgNS, 'rect');\n      rect.setAttribute('data-index', index);\n      rect.setAttribute('x', x);\n      rect.setAttribute('y', y);\n      rect.setAttribute('width', w);\n      rect.setAttribute('height', h);\n      rect.setAttribute('fill', fill);\n      if (stroke) {\n        rect.setAttribute('stroke', stroke);\n        rect.setAttribute('stroke-width', '3px');\n      }\n      this.svg.appendChild(rect);\n      return rect;\n    }\n  }\n\n  function showFocusTip() {\n    document.querySelector('.embed-focus-tip').classList.add('visible');\n  }\n\n  function hideFocusTip() {\n    document.querySelector('.embed-focus-tip').classList.remove('visible');\n  }\n\n  /*************************\n   * Consts for everyone!\n   ************************/\n// button mappings.\n  const MAPPING_8 = {0:0, 1:1, 2:2, 3:3, 4:4, 5:5, 6:6, 7:7};\n  const MAPPING_4 = {0:0, 1:2, 2:5, 3:7, 4:0, 5:2, 6:5, 7:7};\n  const KEYCODES_NUMBERS = ['Digit1', 'Digit2', 'Digit3', 'Digit4', 'Digit5', 'Digit6', 'Digit7', 'Digit8'];\n  const KEYCODES_STD = ['KeyA', 'KeyS', 'KeyD', 'KeyF', 'KeyJ', 'KeyK', 'KeyL', 'Semicolon'];\n  const KEYCODES_MAKEY = ['ArrowUp','ArrowLeft','ArrowDown','ArrowRight', 'KeyW', 'KeyA', 'KeyS', 'KeyD'];\n\n  let OCTAVES = 7;\n  let NUM_BUTTONS = options.keyCount === 4 ? 4 : 8;\n  let BUTTON_MAPPING = MAPPING_8;\n\n  let keyWhitelist;\n  let TEMPERATURE = getTemperature();\n\n  const heldButtonToVisualData = new Map();\n\n// Which notes the pedal is sustaining.\n  let sustaining = false\n  let sustainingNotes = [];\n\n// Mousedown/up events are weird because you can mouse down in one element and mouse up\n// in another, so you're going to lose that original element and never mouse it up.\n  let mouseDownButton = null;\n\n  const player = new Player();\n  const genie = new mm.PianoGenie(CONSTANTS.GENIE_CHECKPOINT);\n  const painter = new FloatyNotes();\n  const piano = new Piano();\n  let isUsingMakey = false;\n  initEverything();\n\n  /*************************\n   * Basic UI bits\n   ************************/\n  function initEverything() {\n    genie.initialize().then(() => {\n      console.log('ðŸ§žâ€â™€ï¸ ready!');\n      // playBtn.textContent = 'Play';\n      // playBtn.removeAttribute('disabled');\n      // playBtn.classList.remove('loading');\n      showMainScreen();\n    });\n\n    // Start the drawing loop.\n    onWindowResize();\n    updateButtonText();\n    window.requestAnimationFrame(() => painter.drawLoop());\n\n    // Event listeners.\n    document.getElementById('numButtons4').addEventListener('change', (event) => event.target.checked && updateNumButtons(4));\n    document.getElementById('numButtons8').addEventListener('change', (event) => event.target.checked && updateNumButtons(8));\n    document.getElementById('numButtons4').checked = (NUM_BUTTONS === 4);\n    document.getElementById('numButtons8').checked = (NUM_BUTTONS !== 4);\n    updateNumButtons(NUM_BUTTONS);\n\n    window.addEventListener('resize', onWindowResize);\n    window.addEventListener('orientationchange', onWindowResize);\n    window.addEventListener('hashchange', () => TEMPERATURE = getTemperature());\n\n    if(options.embedMode) {\n      window.addEventListener('focus', () => { hideFocusTip(); });\n      window.addEventListener('blur', () => { showFocusTip(); });\n      if (!document.hasFocus()) {\n        showFocusTip();\n      }\n    }\n  }\n\n  function updateNumButtons(num) {\n    NUM_BUTTONS = num;\n    const buttons = document.querySelectorAll('.controls > .keyboard > button.color');\n    BUTTON_MAPPING = (num === 4) ? MAPPING_4 : MAPPING_8;\n\n    // Hide the extra buttons.\n    for (let i = 0; i < buttons.length; i++) {\n      buttons[i].hidden = i >= num;\n    }\n  }\n\n  function showMainScreen() {\n    document.querySelector('.splash').hidden = true;\n    document.querySelector('.loaded').hidden = false;\n\n    document.addEventListener('keydown',onKeyDown);\n\n    controls.addEventListener('touchstart', (event) => doTouchStart(event), {passive: true});\n    controls.addEventListener('touchend', (event) => doTouchEnd(event), {passive: true});\n\n    const hasTouchEvents = ('ontouchstart' in window);\n    if (!hasTouchEvents) {\n      controls.addEventListener('mousedown', (event) => doTouchStart(event));\n      controls.addEventListener('mouseup', (event) => doTouchEnd(event));\n    }\n\n    controls.addEventListener('mouseover', (event) => doTouchMove(event, true));\n    controls.addEventListener('mouseout', (event) => doTouchMove(event, false));\n    controls.addEventListener('touchenter', (event) => doTouchMove(event, true));\n    controls.addEventListener('touchleave', (event) => doTouchMove(event, false));\n    canvas.addEventListener('mouseenter', () => mouseDownButton = null);\n\n    // Output.\n    radioMidiOutYes.addEventListener('click', () => {\n      player.usingMidiOut = true;\n      midiOutBox.hidden = false;\n    });\n    radioAudioYes.addEventListener('click', () => {\n      player.usingMidiOut = false;\n      midiOutBox.hidden = true;\n    });\n\n    if (options.output === 'wave') {\n      radioAudioYes.click();\n    } else if (options.output === 'midi') {\n      radioMidiOutYes.click();\n    }\n\n    // Input.\n    radioMidiInYes.addEventListener('click', () => {\n      player.usingMidiIn = true;\n      midiInBox.hidden = false;\n      isUsingMakey = false;\n      updateButtonText();\n    });\n    radioDeviceYes.addEventListener('click', () => {\n      player.usingMidiIn = false;\n      midiInBox.hidden = true;\n      isUsingMakey = false;\n      updateButtonText();\n    });\n    radioMakeyYes.addEventListener('click', () => {\n      player.usingMidiIn = false;\n      midiInBox.hidden = true;\n      isUsingMakey = true;\n      updateButtonText();\n    });\n\n    if (options.input === 'keyboard') {\n      radioDeviceYes.click();\n    } else if (options.input === 'makey') {\n      radioMakeyYes.click();\n    } else if (options.input === 'midi') {\n      radioMidiInYes.click();\n    }\n\n    // Figure out if WebMidi works.\n    if (navigator.requestMIDIAccess) {\n      midiNotSupported.hidden = true;\n      radioMidiInYes.parentElement.removeAttribute('disabled');\n      radioMidiOutYes.parentElement.removeAttribute('disabled');\n      navigator.requestMIDIAccess()\n        .then(\n          (midi) => player.midiReady(midi),\n          (err) => console.log('Something went wrong', err));\n    } else {\n      midiNotSupported.hidden = false;\n      radioMidiInYes.parentElement.setAttribute('disabled', true);\n      radioMidiOutYes.parentElement.setAttribute('disabled', true);\n    }\n\n    document.addEventListener('keyup', onKeyUp);\n\n    // Slow to start up, so do a fake prediction to warm up the model.\n    const note = genie.nextFromKeyWhitelist(0, keyWhitelist, TEMPERATURE);\n    genie.resetState();\n  }\n\n// Here touch means either touch or mouse.\n  function doTouchStart(event) {\n    event.preventDefault();\n    mouseDownButton = event.target;\n    buttonDown(event.target.dataset.id, true);\n  }\n  function doTouchEnd(event) {\n    event.preventDefault();\n    if (mouseDownButton && mouseDownButton !== event.target) {\n      buttonUp(mouseDownButton.dataset.id);\n    }\n    mouseDownButton = null;\n    buttonUp(event.target.dataset.id);\n  }\n  function doTouchMove(event, down) {\n    // If we're already holding a button down, start holding this one too.\n    if (!mouseDownButton)\n      return;\n\n    if (down)\n      buttonDown(event.target.dataset.id, true);\n    else\n      buttonUp(event.target.dataset.id, true);\n  }\n\n  /*************************\n   * Button actions\n   ************************/\n  function buttonDown(button, fromKeyDown) {\n    // If we're already holding this button down, nothing new to do.\n    if (heldButtonToVisualData.has(button)) {\n      return;\n    }\n\n    const el = document.getElementById(`btn${button}`);\n    if (!el)\n      return;\n    el.setAttribute('active', true);\n\n    const note = genie.nextFromKeyWhitelist(BUTTON_MAPPING[button], keyWhitelist, TEMPERATURE);\n    const pitch = CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + note;\n\n    // Hear it.\n    player.playNoteDown(pitch, button);\n\n    // See it.\n    const rect = piano.highlightNote(note, button);\n\n    if (!rect) {\n      debugger;\n    }\n    // Float it.\n    const noteToPaint = painter.addNote(button, rect.getAttribute('x'), rect.getAttribute('width'));\n    heldButtonToVisualData.set(button, {rect:rect, note:note, noteToPaint:noteToPaint});\n  }\n\n  function buttonUp(button) {\n    const el = document.getElementById(`btn${button}`);\n    if (!el)\n      return;\n    el.removeAttribute('active');\n\n    const thing = heldButtonToVisualData.get(button);\n    if (thing) {\n      // Don't see it.\n      piano.clearNote(thing.rect);\n\n      // Stop holding it down.\n      painter.stopNote(thing.noteToPaint);\n\n      // Maybe stop hearing it.\n      const pitch = CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + thing.note;\n      if (!sustaining) {\n        player.playNoteUp(pitch, button);\n      } else {\n        sustainingNotes.push(CONSTANTS.LOWEST_PIANO_KEY_MIDI_NOTE + thing.note);\n      }\n    }\n    heldButtonToVisualData.delete(button);\n  }\n\n  /*************************\n   * Events\n   ************************/\n  function onKeyDown(event) {\n    // Keydown fires continuously and we don't want that.\n    if (event.repeat) {\n      return;\n    }\n    if (event.key === ' ') {  // sustain pedal\n      sustaining = true;\n    } else if (event.key === '0' || event.key === 'r') {\n      console.log('ðŸ§žâ€â™€ï¸ resetting!');\n      genie.resetState();\n    } else {\n      const button = getButtonFromKeyCode(event.code);\n      if (button != null) {\n        buttonDown(button, true);\n      }\n    }\n  }\n\n  function onKeyUp(event) {\n    if (event.key === ' ') {  // sustain pedal\n      sustaining = false;\n\n      // Release everything.\n      sustainingNotes.forEach((note) => player.playNoteUp(note, -1));\n      sustainingNotes = [];\n    } else {\n      const button = getButtonFromKeyCode(event.code);\n      if (button != null) {\n        buttonUp(button);\n      }\n    }\n  }\n\n  function onWindowResize() {\n    OCTAVES = window.innerWidth > 700 ? 7 : 3;\n    const bonusNotes = OCTAVES > 6 ? 4 : 0;  // starts on an A, ends on a C.\n    const totalNotes = CONSTANTS.NOTES_PER_OCTAVE * OCTAVES + bonusNotes;\n    const totalWhiteNotes = CONSTANTS.WHITE_NOTES_PER_OCTAVE * OCTAVES + (bonusNotes - 1);\n    keyWhitelist = Array(totalNotes).fill().map((x,i) => {\n      if (OCTAVES > 6) return i;\n      // Starting 3 semitones up on small screens (on a C), and a whole octave up.\n      return i + 3 + CONSTANTS.NOTES_PER_OCTAVE;\n    });\n\n    piano.resize(totalWhiteNotes);\n    painter.resize(piano.config.whiteNoteHeight);\n    piano.draw();\n  }\n\n  /*************************\n   * Utils and helpers\n   ************************/\n  function getButtonFromKeyCode(code) {\n    let index;\n    if (isUsingMakey) {\n      index = KEYCODES_MAKEY.indexOf(code);\n    } else {\n      index = KEYCODES_NUMBERS.indexOf(code);\n      if (index === -1) {\n        index = KEYCODES_STD.indexOf(code);\n      }\n    }\n    return index !== -1 ? index : null;\n  }\n\n  function getTemperature() {\n    const hash = parseFloat(parseHashParameters()['temperature']) || 0.25;\n    const newTemp = Math.min(1, hash);\n    console.log('ðŸ§žâ€â™€ï¸ temperature = ', newTemp);\n    return newTemp;\n  }\n\n  function parseHashParameters() {\n    const hash = window.location.hash.substring(1);\n    const params = {}\n    hash.split('&').map(hk => {\n      let temp = hk.split('=');\n      params[temp[0]] = temp[1]\n    });\n    return params;\n  }\n\n  function updateButtonText() {\n    const btns = document.querySelectorAll('.controls button.color');\n    const display = IMAGINARY.i18n.t(isUsingMakey ? 'keysMakeyMakey' : 'keys').split(' ');\n    for (let i = 0; i < btns.length; i += 1) {\n      if (options.showInputKeysText) {\n        btns[i].innerHTML = isUsingMakey\n          ? `<span>${display[i]}</span>`\n          : `<span>${i + 1}</span><br><span>${display[i]}</span>`;\n      }\n\n      if (!options.showInputKeys) {\n        btns[i].style.display = 'none';\n      }\n    }\n  }\n\n  document.querySelector('#btnInfo').addEventListener('click', () => {\n    const infoBox = document.querySelector('#infoBox');\n    infoBox.hidden = !infoBox.hidden;\n  });\n\n  if (!options.showInfoButton) {\n    document.querySelector('#btnInfo').style.display = 'none';\n  }\n\n  if (!options.showInputInstructions) {\n    document.querySelector('[data-i18n-field=INFO_INSTRUCTIONS]').style.display = 'none';\n  }\n\n  document.querySelector('#btnSettings').addEventListener('click', () => {\n    const settingsBox = document.querySelector('#settingsBox');\n    settingsBox.hidden = !settingsBox.hidden;\n  });\n\n  if (!options.showConfigButton) {\n    document.querySelector('#btnSettings').style.display = 'none';\n  }\n\n  const body = document.querySelector('body');\n  if (!body.requestFullscreen || !options.showFullScreenButton) {\n    document.querySelector('#btnFullscreen').style.display = 'none';\n  } else {\n    document.querySelector('#btnFullscreen').addEventListener('click', () => {\n      if (!document.fullscreenElement) {\n        body.requestFullscreen().catch((err) => {\n          alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);\n        });\n      } else {\n        document.exitFullscreen();\n      }\n    });\n  }\n}\n","'use strict';\n\nvar replace = String.prototype.replace;\nvar percentTwenties = /%20/g;\n\nvar util = require('./utils');\n\nvar Format = {\n    RFC1738: 'RFC1738',\n    RFC3986: 'RFC3986'\n};\n\nmodule.exports = util.assign(\n    {\n        'default': Format.RFC3986,\n        formatters: {\n            RFC1738: function (value) {\n                return replace.call(value, percentTwenties, '+');\n            },\n            RFC3986: function (value) {\n                return String(value);\n            }\n        }\n    },\n    Format\n);\n","'use strict';\n\nvar stringify = require('./stringify');\nvar parse = require('./parse');\nvar formats = require('./formats');\n\nmodule.exports = {\n    formats: formats,\n    parse: parse,\n    stringify: stringify\n};\n","'use strict';\n\nvar utils = require('./utils');\n\nvar has = Object.prototype.hasOwnProperty;\nvar isArray = Array.isArray;\n\nvar defaults = {\n    allowDots: false,\n    allowPrototypes: false,\n    arrayLimit: 20,\n    charset: 'utf-8',\n    charsetSentinel: false,\n    comma: false,\n    decoder: utils.decode,\n    delimiter: '&',\n    depth: 5,\n    ignoreQueryPrefix: false,\n    interpretNumericEntities: false,\n    parameterLimit: 1000,\n    parseArrays: true,\n    plainObjects: false,\n    strictNullHandling: false\n};\n\nvar interpretNumericEntities = function (str) {\n    return str.replace(/&#(\\d+);/g, function ($0, numberStr) {\n        return String.fromCharCode(parseInt(numberStr, 10));\n    });\n};\n\nvar parseArrayValue = function (val, options) {\n    if (val && typeof val === 'string' && options.comma && val.indexOf(',') > -1) {\n        return val.split(',');\n    }\n\n    return val;\n};\n\n// This is what browsers will submit when the âœ“ character occurs in an\n// application/x-www-form-urlencoded body and the encoding of the page containing\n// the form is iso-8859-1, or when the submitted form has an accept-charset\n// attribute of iso-8859-1. Presumably also with other charsets that do not contain\n// the âœ“ character, such as us-ascii.\nvar isoSentinel = 'utf8=%26%2310003%3B'; // encodeURIComponent('&#10003;')\n\n// These are the percent-encoded utf-8 octets representing a checkmark, indicating that the request actually is utf-8 encoded.\nvar charsetSentinel = 'utf8=%E2%9C%93'; // encodeURIComponent('âœ“')\n\nvar parseValues = function parseQueryStringValues(str, options) {\n    var obj = {};\n    var cleanStr = options.ignoreQueryPrefix ? str.replace(/^\\?/, '') : str;\n    var limit = options.parameterLimit === Infinity ? undefined : options.parameterLimit;\n    var parts = cleanStr.split(options.delimiter, limit);\n    var skipIndex = -1; // Keep track of where the utf8 sentinel was found\n    var i;\n\n    var charset = options.charset;\n    if (options.charsetSentinel) {\n        for (i = 0; i < parts.length; ++i) {\n            if (parts[i].indexOf('utf8=') === 0) {\n                if (parts[i] === charsetSentinel) {\n                    charset = 'utf-8';\n                } else if (parts[i] === isoSentinel) {\n                    charset = 'iso-8859-1';\n                }\n                skipIndex = i;\n                i = parts.length; // The eslint settings do not allow break;\n            }\n        }\n    }\n\n    for (i = 0; i < parts.length; ++i) {\n        if (i === skipIndex) {\n            continue;\n        }\n        var part = parts[i];\n\n        var bracketEqualsPos = part.indexOf(']=');\n        var pos = bracketEqualsPos === -1 ? part.indexOf('=') : bracketEqualsPos + 1;\n\n        var key, val;\n        if (pos === -1) {\n            key = options.decoder(part, defaults.decoder, charset, 'key');\n            val = options.strictNullHandling ? null : '';\n        } else {\n            key = options.decoder(part.slice(0, pos), defaults.decoder, charset, 'key');\n            val = utils.maybeMap(\n                parseArrayValue(part.slice(pos + 1), options),\n                function (encodedVal) {\n                    return options.decoder(encodedVal, defaults.decoder, charset, 'value');\n                }\n            );\n        }\n\n        if (val && options.interpretNumericEntities && charset === 'iso-8859-1') {\n            val = interpretNumericEntities(val);\n        }\n\n        if (part.indexOf('[]=') > -1) {\n            val = isArray(val) ? [val] : val;\n        }\n\n        if (has.call(obj, key)) {\n            obj[key] = utils.combine(obj[key], val);\n        } else {\n            obj[key] = val;\n        }\n    }\n\n    return obj;\n};\n\nvar parseObject = function (chain, val, options, valuesParsed) {\n    var leaf = valuesParsed ? val : parseArrayValue(val, options);\n\n    for (var i = chain.length - 1; i >= 0; --i) {\n        var obj;\n        var root = chain[i];\n\n        if (root === '[]' && options.parseArrays) {\n            obj = [].concat(leaf);\n        } else {\n            obj = options.plainObjects ? Object.create(null) : {};\n            var cleanRoot = root.charAt(0) === '[' && root.charAt(root.length - 1) === ']' ? root.slice(1, -1) : root;\n            var index = parseInt(cleanRoot, 10);\n            if (!options.parseArrays && cleanRoot === '') {\n                obj = { 0: leaf };\n            } else if (\n                !isNaN(index)\n                && root !== cleanRoot\n                && String(index) === cleanRoot\n                && index >= 0\n                && (options.parseArrays && index <= options.arrayLimit)\n            ) {\n                obj = [];\n                obj[index] = leaf;\n            } else {\n                obj[cleanRoot] = leaf;\n            }\n        }\n\n        leaf = obj; // eslint-disable-line no-param-reassign\n    }\n\n    return leaf;\n};\n\nvar parseKeys = function parseQueryStringKeys(givenKey, val, options, valuesParsed) {\n    if (!givenKey) {\n        return;\n    }\n\n    // Transform dot notation to bracket notation\n    var key = options.allowDots ? givenKey.replace(/\\.([^.[]+)/g, '[$1]') : givenKey;\n\n    // The regex chunks\n\n    var brackets = /(\\[[^[\\]]*])/;\n    var child = /(\\[[^[\\]]*])/g;\n\n    // Get the parent\n\n    var segment = options.depth > 0 && brackets.exec(key);\n    var parent = segment ? key.slice(0, segment.index) : key;\n\n    // Stash the parent if it exists\n\n    var keys = [];\n    if (parent) {\n        // If we aren't using plain objects, optionally prefix keys that would overwrite object prototype properties\n        if (!options.plainObjects && has.call(Object.prototype, parent)) {\n            if (!options.allowPrototypes) {\n                return;\n            }\n        }\n\n        keys.push(parent);\n    }\n\n    // Loop through children appending to the array until we hit depth\n\n    var i = 0;\n    while (options.depth > 0 && (segment = child.exec(key)) !== null && i < options.depth) {\n        i += 1;\n        if (!options.plainObjects && has.call(Object.prototype, segment[1].slice(1, -1))) {\n            if (!options.allowPrototypes) {\n                return;\n            }\n        }\n        keys.push(segment[1]);\n    }\n\n    // If there's a remainder, just add whatever is left\n\n    if (segment) {\n        keys.push('[' + key.slice(segment.index) + ']');\n    }\n\n    return parseObject(keys, val, options, valuesParsed);\n};\n\nvar normalizeParseOptions = function normalizeParseOptions(opts) {\n    if (!opts) {\n        return defaults;\n    }\n\n    if (opts.decoder !== null && opts.decoder !== undefined && typeof opts.decoder !== 'function') {\n        throw new TypeError('Decoder has to be a function.');\n    }\n\n    if (typeof opts.charset !== 'undefined' && opts.charset !== 'utf-8' && opts.charset !== 'iso-8859-1') {\n        throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');\n    }\n    var charset = typeof opts.charset === 'undefined' ? defaults.charset : opts.charset;\n\n    return {\n        allowDots: typeof opts.allowDots === 'undefined' ? defaults.allowDots : !!opts.allowDots,\n        allowPrototypes: typeof opts.allowPrototypes === 'boolean' ? opts.allowPrototypes : defaults.allowPrototypes,\n        arrayLimit: typeof opts.arrayLimit === 'number' ? opts.arrayLimit : defaults.arrayLimit,\n        charset: charset,\n        charsetSentinel: typeof opts.charsetSentinel === 'boolean' ? opts.charsetSentinel : defaults.charsetSentinel,\n        comma: typeof opts.comma === 'boolean' ? opts.comma : defaults.comma,\n        decoder: typeof opts.decoder === 'function' ? opts.decoder : defaults.decoder,\n        delimiter: typeof opts.delimiter === 'string' || utils.isRegExp(opts.delimiter) ? opts.delimiter : defaults.delimiter,\n        // eslint-disable-next-line no-implicit-coercion, no-extra-parens\n        depth: (typeof opts.depth === 'number' || opts.depth === false) ? +opts.depth : defaults.depth,\n        ignoreQueryPrefix: opts.ignoreQueryPrefix === true,\n        interpretNumericEntities: typeof opts.interpretNumericEntities === 'boolean' ? opts.interpretNumericEntities : defaults.interpretNumericEntities,\n        parameterLimit: typeof opts.parameterLimit === 'number' ? opts.parameterLimit : defaults.parameterLimit,\n        parseArrays: opts.parseArrays !== false,\n        plainObjects: typeof opts.plainObjects === 'boolean' ? opts.plainObjects : defaults.plainObjects,\n        strictNullHandling: typeof opts.strictNullHandling === 'boolean' ? opts.strictNullHandling : defaults.strictNullHandling\n    };\n};\n\nmodule.exports = function (str, opts) {\n    var options = normalizeParseOptions(opts);\n\n    if (str === '' || str === null || typeof str === 'undefined') {\n        return options.plainObjects ? Object.create(null) : {};\n    }\n\n    var tempObj = typeof str === 'string' ? parseValues(str, options) : str;\n    var obj = options.plainObjects ? Object.create(null) : {};\n\n    // Iterate over the keys and setup the new object\n\n    var keys = Object.keys(tempObj);\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var newObj = parseKeys(key, tempObj[key], options, typeof str === 'string');\n        obj = utils.merge(obj, newObj, options);\n    }\n\n    return utils.compact(obj);\n};\n","'use strict';\n\nvar utils = require('./utils');\nvar formats = require('./formats');\nvar has = Object.prototype.hasOwnProperty;\n\nvar arrayPrefixGenerators = {\n    brackets: function brackets(prefix) {\n        return prefix + '[]';\n    },\n    comma: 'comma',\n    indices: function indices(prefix, key) {\n        return prefix + '[' + key + ']';\n    },\n    repeat: function repeat(prefix) {\n        return prefix;\n    }\n};\n\nvar isArray = Array.isArray;\nvar push = Array.prototype.push;\nvar pushToArray = function (arr, valueOrArray) {\n    push.apply(arr, isArray(valueOrArray) ? valueOrArray : [valueOrArray]);\n};\n\nvar toISO = Date.prototype.toISOString;\n\nvar defaultFormat = formats['default'];\nvar defaults = {\n    addQueryPrefix: false,\n    allowDots: false,\n    charset: 'utf-8',\n    charsetSentinel: false,\n    delimiter: '&',\n    encode: true,\n    encoder: utils.encode,\n    encodeValuesOnly: false,\n    format: defaultFormat,\n    formatter: formats.formatters[defaultFormat],\n    // deprecated\n    indices: false,\n    serializeDate: function serializeDate(date) {\n        return toISO.call(date);\n    },\n    skipNulls: false,\n    strictNullHandling: false\n};\n\nvar isNonNullishPrimitive = function isNonNullishPrimitive(v) {\n    return typeof v === 'string'\n        || typeof v === 'number'\n        || typeof v === 'boolean'\n        || typeof v === 'symbol'\n        || typeof v === 'bigint';\n};\n\nvar stringify = function stringify(\n    object,\n    prefix,\n    generateArrayPrefix,\n    strictNullHandling,\n    skipNulls,\n    encoder,\n    filter,\n    sort,\n    allowDots,\n    serializeDate,\n    formatter,\n    encodeValuesOnly,\n    charset\n) {\n    var obj = object;\n    if (typeof filter === 'function') {\n        obj = filter(prefix, obj);\n    } else if (obj instanceof Date) {\n        obj = serializeDate(obj);\n    } else if (generateArrayPrefix === 'comma' && isArray(obj)) {\n        obj = utils.maybeMap(obj, function (value) {\n            if (value instanceof Date) {\n                return serializeDate(value);\n            }\n            return value;\n        }).join(',');\n    }\n\n    if (obj === null) {\n        if (strictNullHandling) {\n            return encoder && !encodeValuesOnly ? encoder(prefix, defaults.encoder, charset, 'key') : prefix;\n        }\n\n        obj = '';\n    }\n\n    if (isNonNullishPrimitive(obj) || utils.isBuffer(obj)) {\n        if (encoder) {\n            var keyValue = encodeValuesOnly ? prefix : encoder(prefix, defaults.encoder, charset, 'key');\n            return [formatter(keyValue) + '=' + formatter(encoder(obj, defaults.encoder, charset, 'value'))];\n        }\n        return [formatter(prefix) + '=' + formatter(String(obj))];\n    }\n\n    var values = [];\n\n    if (typeof obj === 'undefined') {\n        return values;\n    }\n\n    var objKeys;\n    if (isArray(filter)) {\n        objKeys = filter;\n    } else {\n        var keys = Object.keys(obj);\n        objKeys = sort ? keys.sort(sort) : keys;\n    }\n\n    for (var i = 0; i < objKeys.length; ++i) {\n        var key = objKeys[i];\n        var value = obj[key];\n\n        if (skipNulls && value === null) {\n            continue;\n        }\n\n        var keyPrefix = isArray(obj)\n            ? typeof generateArrayPrefix === 'function' ? generateArrayPrefix(prefix, key) : prefix\n            : prefix + (allowDots ? '.' + key : '[' + key + ']');\n\n        pushToArray(values, stringify(\n            value,\n            keyPrefix,\n            generateArrayPrefix,\n            strictNullHandling,\n            skipNulls,\n            encoder,\n            filter,\n            sort,\n            allowDots,\n            serializeDate,\n            formatter,\n            encodeValuesOnly,\n            charset\n        ));\n    }\n\n    return values;\n};\n\nvar normalizeStringifyOptions = function normalizeStringifyOptions(opts) {\n    if (!opts) {\n        return defaults;\n    }\n\n    if (opts.encoder !== null && opts.encoder !== undefined && typeof opts.encoder !== 'function') {\n        throw new TypeError('Encoder has to be a function.');\n    }\n\n    var charset = opts.charset || defaults.charset;\n    if (typeof opts.charset !== 'undefined' && opts.charset !== 'utf-8' && opts.charset !== 'iso-8859-1') {\n        throw new TypeError('The charset option must be either utf-8, iso-8859-1, or undefined');\n    }\n\n    var format = formats['default'];\n    if (typeof opts.format !== 'undefined') {\n        if (!has.call(formats.formatters, opts.format)) {\n            throw new TypeError('Unknown format option provided.');\n        }\n        format = opts.format;\n    }\n    var formatter = formats.formatters[format];\n\n    var filter = defaults.filter;\n    if (typeof opts.filter === 'function' || isArray(opts.filter)) {\n        filter = opts.filter;\n    }\n\n    return {\n        addQueryPrefix: typeof opts.addQueryPrefix === 'boolean' ? opts.addQueryPrefix : defaults.addQueryPrefix,\n        allowDots: typeof opts.allowDots === 'undefined' ? defaults.allowDots : !!opts.allowDots,\n        charset: charset,\n        charsetSentinel: typeof opts.charsetSentinel === 'boolean' ? opts.charsetSentinel : defaults.charsetSentinel,\n        delimiter: typeof opts.delimiter === 'undefined' ? defaults.delimiter : opts.delimiter,\n        encode: typeof opts.encode === 'boolean' ? opts.encode : defaults.encode,\n        encoder: typeof opts.encoder === 'function' ? opts.encoder : defaults.encoder,\n        encodeValuesOnly: typeof opts.encodeValuesOnly === 'boolean' ? opts.encodeValuesOnly : defaults.encodeValuesOnly,\n        filter: filter,\n        formatter: formatter,\n        serializeDate: typeof opts.serializeDate === 'function' ? opts.serializeDate : defaults.serializeDate,\n        skipNulls: typeof opts.skipNulls === 'boolean' ? opts.skipNulls : defaults.skipNulls,\n        sort: typeof opts.sort === 'function' ? opts.sort : null,\n        strictNullHandling: typeof opts.strictNullHandling === 'boolean' ? opts.strictNullHandling : defaults.strictNullHandling\n    };\n};\n\nmodule.exports = function (object, opts) {\n    var obj = object;\n    var options = normalizeStringifyOptions(opts);\n\n    var objKeys;\n    var filter;\n\n    if (typeof options.filter === 'function') {\n        filter = options.filter;\n        obj = filter('', obj);\n    } else if (isArray(options.filter)) {\n        filter = options.filter;\n        objKeys = filter;\n    }\n\n    var keys = [];\n\n    if (typeof obj !== 'object' || obj === null) {\n        return '';\n    }\n\n    var arrayFormat;\n    if (opts && opts.arrayFormat in arrayPrefixGenerators) {\n        arrayFormat = opts.arrayFormat;\n    } else if (opts && 'indices' in opts) {\n        arrayFormat = opts.indices ? 'indices' : 'repeat';\n    } else {\n        arrayFormat = 'indices';\n    }\n\n    var generateArrayPrefix = arrayPrefixGenerators[arrayFormat];\n\n    if (!objKeys) {\n        objKeys = Object.keys(obj);\n    }\n\n    if (options.sort) {\n        objKeys.sort(options.sort);\n    }\n\n    for (var i = 0; i < objKeys.length; ++i) {\n        var key = objKeys[i];\n\n        if (options.skipNulls && obj[key] === null) {\n            continue;\n        }\n        pushToArray(keys, stringify(\n            obj[key],\n            key,\n            generateArrayPrefix,\n            options.strictNullHandling,\n            options.skipNulls,\n            options.encode ? options.encoder : null,\n            options.filter,\n            options.sort,\n            options.allowDots,\n            options.serializeDate,\n            options.formatter,\n            options.encodeValuesOnly,\n            options.charset\n        ));\n    }\n\n    var joined = keys.join(options.delimiter);\n    var prefix = options.addQueryPrefix === true ? '?' : '';\n\n    if (options.charsetSentinel) {\n        if (options.charset === 'iso-8859-1') {\n            // encodeURIComponent('&#10003;'), the \"numeric entity\" representation of a checkmark\n            prefix += 'utf8=%26%2310003%3B&';\n        } else {\n            // encodeURIComponent('âœ“')\n            prefix += 'utf8=%E2%9C%93&';\n        }\n    }\n\n    return joined.length > 0 ? prefix + joined : '';\n};\n","'use strict';\n\nvar has = Object.prototype.hasOwnProperty;\nvar isArray = Array.isArray;\n\nvar hexTable = (function () {\n    var array = [];\n    for (var i = 0; i < 256; ++i) {\n        array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase());\n    }\n\n    return array;\n}());\n\nvar compactQueue = function compactQueue(queue) {\n    while (queue.length > 1) {\n        var item = queue.pop();\n        var obj = item.obj[item.prop];\n\n        if (isArray(obj)) {\n            var compacted = [];\n\n            for (var j = 0; j < obj.length; ++j) {\n                if (typeof obj[j] !== 'undefined') {\n                    compacted.push(obj[j]);\n                }\n            }\n\n            item.obj[item.prop] = compacted;\n        }\n    }\n};\n\nvar arrayToObject = function arrayToObject(source, options) {\n    var obj = options && options.plainObjects ? Object.create(null) : {};\n    for (var i = 0; i < source.length; ++i) {\n        if (typeof source[i] !== 'undefined') {\n            obj[i] = source[i];\n        }\n    }\n\n    return obj;\n};\n\nvar merge = function merge(target, source, options) {\n    /* eslint no-param-reassign: 0 */\n    if (!source) {\n        return target;\n    }\n\n    if (typeof source !== 'object') {\n        if (isArray(target)) {\n            target.push(source);\n        } else if (target && typeof target === 'object') {\n            if ((options && (options.plainObjects || options.allowPrototypes)) || !has.call(Object.prototype, source)) {\n                target[source] = true;\n            }\n        } else {\n            return [target, source];\n        }\n\n        return target;\n    }\n\n    if (!target || typeof target !== 'object') {\n        return [target].concat(source);\n    }\n\n    var mergeTarget = target;\n    if (isArray(target) && !isArray(source)) {\n        mergeTarget = arrayToObject(target, options);\n    }\n\n    if (isArray(target) && isArray(source)) {\n        source.forEach(function (item, i) {\n            if (has.call(target, i)) {\n                var targetItem = target[i];\n                if (targetItem && typeof targetItem === 'object' && item && typeof item === 'object') {\n                    target[i] = merge(targetItem, item, options);\n                } else {\n                    target.push(item);\n                }\n            } else {\n                target[i] = item;\n            }\n        });\n        return target;\n    }\n\n    return Object.keys(source).reduce(function (acc, key) {\n        var value = source[key];\n\n        if (has.call(acc, key)) {\n            acc[key] = merge(acc[key], value, options);\n        } else {\n            acc[key] = value;\n        }\n        return acc;\n    }, mergeTarget);\n};\n\nvar assign = function assignSingleSource(target, source) {\n    return Object.keys(source).reduce(function (acc, key) {\n        acc[key] = source[key];\n        return acc;\n    }, target);\n};\n\nvar decode = function (str, decoder, charset) {\n    var strWithoutPlus = str.replace(/\\+/g, ' ');\n    if (charset === 'iso-8859-1') {\n        // unescape never throws, no try...catch needed:\n        return strWithoutPlus.replace(/%[0-9a-f]{2}/gi, unescape);\n    }\n    // utf-8\n    try {\n        return decodeURIComponent(strWithoutPlus);\n    } catch (e) {\n        return strWithoutPlus;\n    }\n};\n\nvar encode = function encode(str, defaultEncoder, charset) {\n    // This code was originally written by Brian White (mscdex) for the io.js core querystring library.\n    // It has been adapted here for stricter adherence to RFC 3986\n    if (str.length === 0) {\n        return str;\n    }\n\n    var string = str;\n    if (typeof str === 'symbol') {\n        string = Symbol.prototype.toString.call(str);\n    } else if (typeof str !== 'string') {\n        string = String(str);\n    }\n\n    if (charset === 'iso-8859-1') {\n        return escape(string).replace(/%u[0-9a-f]{4}/gi, function ($0) {\n            return '%26%23' + parseInt($0.slice(2), 16) + '%3B';\n        });\n    }\n\n    var out = '';\n    for (var i = 0; i < string.length; ++i) {\n        var c = string.charCodeAt(i);\n\n        if (\n            c === 0x2D // -\n            || c === 0x2E // .\n            || c === 0x5F // _\n            || c === 0x7E // ~\n            || (c >= 0x30 && c <= 0x39) // 0-9\n            || (c >= 0x41 && c <= 0x5A) // a-z\n            || (c >= 0x61 && c <= 0x7A) // A-Z\n        ) {\n            out += string.charAt(i);\n            continue;\n        }\n\n        if (c < 0x80) {\n            out = out + hexTable[c];\n            continue;\n        }\n\n        if (c < 0x800) {\n            out = out + (hexTable[0xC0 | (c >> 6)] + hexTable[0x80 | (c & 0x3F)]);\n            continue;\n        }\n\n        if (c < 0xD800 || c >= 0xE000) {\n            out = out + (hexTable[0xE0 | (c >> 12)] + hexTable[0x80 | ((c >> 6) & 0x3F)] + hexTable[0x80 | (c & 0x3F)]);\n            continue;\n        }\n\n        i += 1;\n        c = 0x10000 + (((c & 0x3FF) << 10) | (string.charCodeAt(i) & 0x3FF));\n        out += hexTable[0xF0 | (c >> 18)]\n            + hexTable[0x80 | ((c >> 12) & 0x3F)]\n            + hexTable[0x80 | ((c >> 6) & 0x3F)]\n            + hexTable[0x80 | (c & 0x3F)];\n    }\n\n    return out;\n};\n\nvar compact = function compact(value) {\n    var queue = [{ obj: { o: value }, prop: 'o' }];\n    var refs = [];\n\n    for (var i = 0; i < queue.length; ++i) {\n        var item = queue[i];\n        var obj = item.obj[item.prop];\n\n        var keys = Object.keys(obj);\n        for (var j = 0; j < keys.length; ++j) {\n            var key = keys[j];\n            var val = obj[key];\n            if (typeof val === 'object' && val !== null && refs.indexOf(val) === -1) {\n                queue.push({ obj: obj, prop: key });\n                refs.push(val);\n            }\n        }\n    }\n\n    compactQueue(queue);\n\n    return value;\n};\n\nvar isRegExp = function isRegExp(obj) {\n    return Object.prototype.toString.call(obj) === '[object RegExp]';\n};\n\nvar isBuffer = function isBuffer(obj) {\n    if (!obj || typeof obj !== 'object') {\n        return false;\n    }\n\n    return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj));\n};\n\nvar combine = function combine(a, b) {\n    return [].concat(a, b);\n};\n\nvar maybeMap = function maybeMap(val, fn) {\n    if (isArray(val)) {\n        var mapped = [];\n        for (var i = 0; i < val.length; i += 1) {\n            mapped.push(fn(val[i]));\n        }\n        return mapped;\n    }\n    return fn(val);\n};\n\nmodule.exports = {\n    arrayToObject: arrayToObject,\n    assign: assign,\n    combine: combine,\n    compact: compact,\n    decode: decode,\n    encode: encode,\n    isBuffer: isBuffer,\n    isRegExp: isRegExp,\n    maybeMap: maybeMap,\n    merge: merge\n};\n"]}