!function r(a,s,c){function u(e,t){if(!s[e]){if(!a[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(d)return d(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var o=s[e]={exports:{}};a[e][0].call(o.exports,function(t){return u(a[e][1][t]||t)},o,o.exports,r,a,s,c)}return s[e].exports}for(var d="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}({1:[function(t,e,n){"use strict";var i=t("./piano-genie");function c(t,e,n,i,o,r,a){try{var s=t[r](a),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,o)}function o(s){return function(){var t=this,a=arguments;return new Promise(function(e,n){var i=s.apply(t,a);function o(t){c(i,e,n,o,r,"next",t)}function r(t){c(i,e,n,o,r,"throw",t)}o(void 0)})}}var r,a={defaultLanguage:"en"};function s(){return u.apply(this,arguments)}function u(){return(u=o(regeneratorRuntime.mark(function t(e){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(e);case 2:if(200<=(n=t.sent).status&&n.status<300)return t.prev=4,t.next=7,n.json();t.next=13;break;case 7:return t.abrupt("return",t.sent);case 10:throw t.prev=10,t.t0=t.catch(4),new Error("Error parsing config file: ".concat(t.t0.message));case 13:throw new Error("Server returned status ".concat(n.status," (").concat(n.statusText,") loading config file."));case 14:case"end":return t.stop()}},t,null,[[4,10]])}))).apply(this,arguments)}r=o(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=Object,t.t1={},t.t2=a,t.next=6,s("./config.json");case 6:return t.t3=t.sent,e=t.t0.assign.call(t.t0,t.t1,t.t2,t.t3),t.next=10,IMAGINARY.i18n.init({queryStringVariable:"lang",translationsDirectory:"tr",defaultLanguage:e.defaultLanguage||"en"});case 10:(0,i.initPianoGenie)(),t.next=16;break;case 13:t.prev=13,t.t4=t.catch(0),console.error(t.t4);case 16:case"end":return t.stop()}},t,null,[[0,13]])})),function(){r.apply(this,arguments)}()},{"./piano-genie":2}],2:[function(t,e,n){"use strict";function R(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function P(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}Object.defineProperty(n,"__esModule",{value:!0}),n.initPianoGenie=function(){var a,c={COLORS:["#db4c67","#ff8459","#ffec02","#73ff6c","#00c5ba","#3753be","#9c52ff","#ef71f2"],NUM_BUTTONS:8,NOTES_PER_OCTAVE:12,WHITE_NOTES_PER_OCTAVE:7,LOWEST_PIANO_KEY_MIDI_NOTE:21,GENIE_CHECKPOINT:"model/genie"},t=function(){function t(){R(this,t),this.player=new mm.SoundFontPlayer("vendor/sgm_plus"),this.midiOut=[],this.midiIn=[],this.usingMidiOut=!1,this.usingMidiIn=!1,this.selectOutElement=document.getElementById("selectOut"),this.selectInElement=document.getElementById("selectIn"),this.loadAllSamples()}return P(t,[{key:"loadAllSamples",value:function(){for(var t={notes:[]},e=0;e<c.NOTES_PER_OCTAVE*d;e++)t.notes.push({pitch:c.LOWEST_PIANO_KEY_MIDI_NOTE+e});this.player.loadSamples(t)}},{key:"playNoteDown",value:function(t,e){this.usingMidiOut?this.sendMidiNoteOn(t,e):(mm.Player.tone.context.resume(),this.player.playNoteDown({pitch:t}))}},{key:"playNoteUp",value:function(t,e){this.usingMidiOut?this.sendMidiNoteOff(t,e):this.player.playNoteUp({pitch:t})}},{key:"midiReady",value:function(t){var e=this;t.addEventListener("statechange",function(t){return e.initDevices(t.target)}),this.initDevices(t)}},{key:"initDevices",value:function(t){var e=this;this.midiOut=[],this.midiIn=[];for(var n=t.outputs.values(),i=n.next();i&&!i.done;i=n.next())this.midiOut.push(i.value);for(var o=t.inputs.values(),r=o.next();r&&!r.done;r=o.next())this.midiIn.push(r.value),r.value.onmidimessage=function(t){return e.getMIDIMessage(t)};this.selectInElement.innerHTML=this.midiIn.map(function(t){return"<option>".concat(t.name,"</option>")}).join(""),this.selectOutElement.innerHTML=this.midiOut.map(function(t){return"<option>".concat(t.name,"</option>")}).join("")}},{key:"sendMidiNoteOn",value:function(t,e){-1===e&&(e=0);var n=[144,t,127];this.midiOut[this.selectOutElement.selectedIndex].send(n)}},{key:"sendMidiNoteOff",value:function(t,e){-1===e&&(e=0);var n=[128,t,127];this.midiOut[this.selectOutElement.selectedIndex].send(n)}},{key:"getMIDIMessage",value:function(t){if(this.usingMidiIn){var e=t.data[0],n=t.data[1];2<t.data.length&&t.data[2];switch(e){case 144:A(n);break;case 128:x(n)}}}}]),t}(),e=function(){function t(){R(this,t),this.notes=[],this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.context.lineWidth=4,this.context.lineCap="round",this.contextHeight=0}return P(t,[{key:"resize",value:function(t){this.canvas.width=window.innerWidth,this.canvas.height=this.contextHeight=window.innerHeight-t-20}},{key:"addNote",value:function(t,e,n){var i={x:parseFloat(e),y:0,width:parseFloat(n),height:0,color:c.COLORS[t],on:!0};return this.notes.push(i),i}},{key:"stopNote",value:function(t){t.on=!1}},{key:"drawLoop",value:function(){var e=this;this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.notes=this.notes.filter(function(t){return t.on||t.y<e.contextHeight-100});for(var t=0;t<this.notes.length;t++){var n=this.notes[t];n.on?n.height+=3:n.y+=3,this.context.globalAlpha=1-n.y/this.contextHeight,this.context.fillStyle=n.color,this.context.fillRect(n.x,n.y,n.width,n.height)}window.requestAnimationFrame(function(){return e.drawLoop()})}}]),t}(),n=function(){function t(){R(this,t),this.config={whiteNoteWidth:20,blackNoteWidth:20,whiteNoteHeight:70,blackNoteHeight:140/3},this.svg=document.getElementById("svg"),this.svgNS="http://www.w3.org/2000/svg"}return P(t,[{key:"resize",value:function(t){var e=window.innerWidth/t;this.config.whiteNoteWidth=6<d?e:Math.floor(e),this.config.blackNoteWidth=2*this.config.whiteNoteWidth/3,this.svg.setAttribute("width",window.innerWidth),this.svg.setAttribute("height",this.config.whiteNoteHeight)}},{key:"draw",value:function(){this.svg.innerHTML="";var t=this.config.blackNoteWidth/2,e=0,n=0,i=[1,3,6,8,10];6<d?(this.makeRect(0,e,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),this.makeRect(2,this.config.whiteNoteWidth,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),n=3,e=2*this.config.whiteNoteWidth):n=3+c.NOTES_PER_OCTAVE;for(var o=0;o<d;o++)for(var r=0;r<c.NOTES_PER_OCTAVE;r++)-1===i.indexOf(r)&&(this.makeRect(n,e,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),e+=this.config.whiteNoteWidth),n++;e=6<d?(this.makeRect(n,e,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),this.makeRect(1,this.config.whiteNoteWidth-t,0,this.config.blackNoteWidth,this.config.blackNoteHeight,"black"),n=3,this.config.whiteNoteWidth):(n=3+c.NOTES_PER_OCTAVE,-this.config.whiteNoteWidth);for(var a=0;a<d;a++)for(var s=0;s<c.NOTES_PER_OCTAVE;s++)-1!==i.indexOf(s)?this.makeRect(n,e+this.config.whiteNoteWidth-t,0,this.config.blackNoteWidth,this.config.blackNoteHeight,"black"):e+=this.config.whiteNoteWidth,n++}},{key:"highlightNote",value:function(t,e){var n=this.svg.querySelector('rect[data-index="'.concat(t,'"]'));if(n)return n.setAttribute("active",!0),n.setAttribute("class","color-".concat(e)),n;console.log("couldnt find a rect for note",t)}},{key:"clearNote",value:function(t){t.removeAttribute("active"),t.removeAttribute("class")}},{key:"makeRect",value:function(t,e,n,i,o,r,a){var s=document.createElementNS(this.svgNS,"rect");return s.setAttribute("data-index",t),s.setAttribute("x",e),s.setAttribute("y",n),s.setAttribute("width",i),s.setAttribute("height",o),s.setAttribute("fill",r),a&&(s.setAttribute("stroke",a),s.setAttribute("stroke-width","3px")),this.svg.appendChild(s),s}}]),t}(),i={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7},o={0:0,1:2,2:5,3:7},r=["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8"],s=["KeyA","KeyS","KeyD","KeyF","KeyJ","KeyK","KeyL","Semicolon"],u=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","KeyW","KeyA","KeyS","KeyD"],d=7,h=i,l=T(),f=new Map,g=!1,v=[],m=null,p=new t,E=new mm.PianoGenie(c.GENIE_CHECKPOINT),y=new e,w=new n,N=!1;function O(t){0;var e=document.querySelectorAll(".controls > button.color");h=4===t?o:i;for(var n=0;n<e.length;n++)e[n].hidden=t<=n}function b(t){t.preventDefault(),m=t.target,A(t.target.dataset.id)}function k(t){t.preventDefault(),m&&m!==t.target&&x(m.dataset.id),m=null,x(t.target.dataset.id)}function I(t,e){m&&(e?A(t.target.dataset.id):x(t.target.dataset.id))}function A(t){var e,n,i,o,r;f.has(t)||(e=document.getElementById("btn".concat(t)))&&(e.setAttribute("active",!0),n=E.nextFromKeyWhitelist(h[t],a,l),i=c.LOWEST_PIANO_KEY_MIDI_NOTE+n,p.playNoteDown(i,t),o=w.highlightNote(n,t),r=y.addNote(t,o.getAttribute("x"),o.getAttribute("width")),f.set(t,{rect:o,note:n,noteToPaint:r}))}function x(t){var e,n,i=document.getElementById("btn".concat(t));i&&(i.removeAttribute("active"),(e=f.get(t))&&(w.clearNote(e.rect),y.stopNote(e.noteToPaint),n=c.LOWEST_PIANO_KEY_MIDI_NOTE+e.note,g?v.push(c.LOWEST_PIANO_KEY_MIDI_NOTE+e.note):p.playNoteUp(n,t)),f.delete(t))}function _(t){var e;t.repeat||(" "===t.key?g=!0:"0"===t.key||"r"===t.key?(console.log("🧞‍♀️ resetting!"),E.resetState()):null!=(e=M(t.code))&&A(e))}function S(t){var e;" "===t.key?(g=!1,v.forEach(function(t){return p.playNoteUp(t,-1)}),v=[]):null!=(e=M(t.code))&&x(e)}function L(){var t=6<(d=700<window.innerWidth?7:3)?4:0,e=c.NOTES_PER_OCTAVE*d+t,n=c.WHITE_NOTES_PER_OCTAVE*d+(t-1);a=Array(e).fill().map(function(t,e){return 6<d?e:e+3+c.NOTES_PER_OCTAVE}),w.resize(n),y.resize(w.config.whiteNoteHeight),w.draw()}function M(t){var e;return N?e=u.indexOf(t):-1===(e=r.indexOf(t))&&(e=s.indexOf(t)),-1!==e?e:null}function T(){var t,n,e=parseFloat((t=window.location.hash.substring(1),n={},t.split("&").map(function(t){var e=t.split("=");n[e[0]]=e[1]}),n).temperature)||.25,i=Math.min(1,e);return console.log("🧞‍♀️ temperature = ",i),i}function W(){for(var t=document.querySelectorAll(".controls button.color"),e=IMAGINARY.i18n.t(N?"keysMakeyMakey":"keys").split(" "),n=0;n<t.length;n++)t[n].innerHTML=N?"<span>".concat(e[n],"</span>"):"<span>".concat(n+1,"</span><br><span>").concat(e[n],"</span>")}E.initialize().then(function(){console.log("🧞‍♀️ ready!"),playBtn.textContent="Play",playBtn.removeAttribute("disabled"),playBtn.classList.remove("loading")}),L(),W(),window.requestAnimationFrame(function(){return y.drawLoop()}),document.getElementById("numButtons4").addEventListener("change",function(t){return t.target.checked&&O(4)}),document.getElementById("numButtons8").addEventListener("change",function(t){return t.target.checked&&O(8)}),window.addEventListener("resize",L),window.addEventListener("orientationchange",L),window.addEventListener("hashchange",function(){return l=T()}),document.querySelector("#playBtn").addEventListener("click",function(){document.querySelector(".splash").hidden=!0,document.querySelector(".loaded").hidden=!1,document.addEventListener("keydown",_),controls.addEventListener("touchstart",b,{passive:!0}),controls.addEventListener("touchend",k,{passive:!0}),"ontouchstart"in window||(controls.addEventListener("mousedown",b),controls.addEventListener("mouseup",k)),controls.addEventListener("mouseover",function(t){return I(t,!0)}),controls.addEventListener("mouseout",function(t){return I(t,!1)}),controls.addEventListener("touchenter",function(t){return I(t,!0)}),controls.addEventListener("touchleave",function(t){return I(t,!1)}),canvas.addEventListener("mouseenter",function(){return m=null}),radioMidiOutYes.addEventListener("click",function(){p.usingMidiOut=!0,midiOutBox.hidden=!1}),radioAudioYes.addEventListener("click",function(){p.usingMidiOut=!1,midiOutBox.hidden=!0}),radioMidiInYes.addEventListener("click",function(){p.usingMidiIn=!0,midiInBox.hidden=!1,N=!1,W()}),radioDeviceYes.addEventListener("click",function(){p.usingMidiIn=!1,midiInBox.hidden=!0,N=!1,W()}),radioMakeyYes.addEventListener("click",function(){p.usingMidiIn=!1,midiInBox.hidden=!0,N=!0,W()}),navigator.requestMIDIAccess?(midiNotSupported.hidden=!0,radioMidiInYes.parentElement.removeAttribute("disabled"),radioMidiOutYes.parentElement.removeAttribute("disabled"),navigator.requestMIDIAccess().then(function(t){return p.midiReady(t)},function(t){return console.log("Something went wrong",t)})):(midiNotSupported.hidden=!1,radioMidiInYes.parentElement.setAttribute("disabled",!0),radioMidiOutYes.parentElement.setAttribute("disabled",!0)),document.addEventListener("keyup",S),E.nextFromKeyWhitelist(0,a,l),E.resetState()}),document.querySelector("#btnSettings").addEventListener("click",function(){var t=document.querySelector("#settingsBox");t.hidden=!t.hidden});var D=document.querySelector("body");D.requestFullscreen?document.querySelector("#btnFullscreen").addEventListener("click",function(){document.fullscreenElement?document.exitFullscreen():D.requestFullscreen().catch(function(t){alert("Error attempting to enable full-screen mode: ".concat(t.message," (").concat(t.name,")"))})}):document.querySelector("#btnFullscreen").style.display="none"}},{}]},{},[1]);
//# sourceMappingURL=bundle.min.js.map
