!function r(s,a,c){function d(e,t){if(!a[e]){if(!s[e]){var i="function"==typeof require&&require;if(!t&&i)return i(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=a[e]={exports:{}};s[e][0].call(o.exports,function(t){return d(s[e][1][t]||t)},o,o.exports,r,s,a,c)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<c.length;t++)d(c[t]);return d}({1:[function(t,e,i){"use strict";var n=t("./original_script");document.querySelector("#playBtn").addEventListener("click",function(){(0,n.showMainScreen)()})},{"./original_script":2}],2:[function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}Object.defineProperty(i,"__esModule",{value:!0}),i.showMainScreen=function(){document.querySelector(".splash").hidden=!0,document.querySelector(".loaded").hidden=!1,document.addEventListener("keydown",H),controls.addEventListener("touchstart",x,{passive:!0}),controls.addEventListener("touchend",L,{passive:!0}),"ontouchstart"in window||(controls.addEventListener("mousedown",x),controls.addEventListener("mouseup",L));controls.addEventListener("mouseover",function(t){return S(t,!0)}),controls.addEventListener("mouseout",function(t){return S(t,!1)}),controls.addEventListener("touchenter",function(t){return S(t,!0)}),controls.addEventListener("touchleave",function(t){return S(t,!1)}),canvas.addEventListener("mouseenter",function(){return I=null}),radioMidiOutYes.addEventListener("click",function(){k.usingMidiOut=!0,midiOutBox.hidden=!1}),radioAudioYes.addEventListener("click",function(){k.usingMidiOut=!1,midiOutBox.hidden=!0}),radioMidiInYes.addEventListener("click",function(){k.usingMidiIn=!0,midiInBox.hidden=!1,M=!1,q()}),radioDeviceYes.addEventListener("click",function(){k.usingMidiIn=!1,midiInBox.hidden=!0,M=!1,q()}),radioMakeyYes.addEventListener("click",function(){k.usingMidiIn=!1,midiInBox.hidden=!0,M=!0,q()}),navigator.requestMIDIAccess?(midiNotSupported.hidden=!0,radioMidiInYes.parentElement.removeAttribute("disabled"),radioMidiOutYes.parentElement.removeAttribute("disabled"),navigator.requestMIDIAccess().then(function(t){return k.midiReady(t)},function(t){return console.log("Something went wrong",t)})):(midiNotSupported.hidden=!1,radioMidiInYes.parentElement.setAttribute("disabled",!0),radioMidiOutYes.parentElement.setAttribute("disabled",!0));document.addEventListener("keyup",R);A.nextFromKeyWhitelist(0,s,p);A.resetState()};var s,c={COLORS:["#EE2B29","#ff9800","#ffff00","#c6ff00","#00e5ff","#2979ff","#651fff","#d500f9"],NUM_BUTTONS:8,NOTES_PER_OCTAVE:12,WHITE_NOTES_PER_OCTAVE:7,LOWEST_PIANO_KEY_MIDI_NOTE:21,GENIE_CHECKPOINT:"model/genie"},a=function(){function t(){n(this,t),this.player=new mm.SoundFontPlayer("vendor/sgm_plus"),this.midiOut=[],this.midiIn=[],this.usingMidiOut=!1,this.usingMidiIn=!1,this.selectOutElement=document.getElementById("selectOut"),this.selectInElement=document.getElementById("selectIn"),this.loadAllSamples()}return r(t,[{key:"loadAllSamples",value:function(){for(var t={notes:[]},e=0;e<c.NOTES_PER_OCTAVE*m;e++)t.notes.push({pitch:c.LOWEST_PIANO_KEY_MIDI_NOTE+e});this.player.loadSamples(t)}},{key:"playNoteDown",value:function(t,e){this.usingMidiOut?this.sendMidiNoteOn(t,e):(mm.Player.tone.context.resume(),this.player.playNoteDown({pitch:t}))}},{key:"playNoteUp",value:function(t,e){this.usingMidiOut?this.sendMidiNoteOff(t,e):this.player.playNoteUp({pitch:t})}},{key:"midiReady",value:function(t){var e=this;t.addEventListener("statechange",function(t){return e.initDevices(t.target)}),this.initDevices(t)}},{key:"initDevices",value:function(t){var e=this;this.midiOut=[],this.midiIn=[];for(var i=t.outputs.values(),n=i.next();n&&!n.done;n=i.next())this.midiOut.push(n.value);for(var o=t.inputs.values(),r=o.next();r&&!r.done;r=o.next())this.midiIn.push(r.value),r.value.onmidimessage=function(t){return e.getMIDIMessage(t)};this.selectInElement.innerHTML=this.midiIn.map(function(t){return"<option>".concat(t.name,"</option>")}).join(""),this.selectOutElement.innerHTML=this.midiOut.map(function(t){return"<option>".concat(t.name,"</option>")}).join("")}},{key:"sendMidiNoteOn",value:function(t,e){-1===e&&(e=0);var i=[144,t,127];this.midiOut[this.selectOutElement.selectedIndex].send(i)}},{key:"sendMidiNoteOff",value:function(t,e){-1===e&&(e=0);var i=[128,t,127];this.midiOut[this.selectOutElement.selectedIndex].send(i)}},{key:"getMIDIMessage",value:function(t){if(this.usingMidiIn){var e=t.data[0],i=t.data[1];2<t.data.length&&t.data[2];switch(e){case 144:W(i);break;case 128:P(i)}}}}]),t}(),d=function(){function t(){n(this,t),this.notes=[],this.canvas=document.getElementById("canvas"),this.context=this.canvas.getContext("2d"),this.context.lineWidth=4,this.context.lineCap="round",this.contextHeight=0}return r(t,[{key:"resize",value:function(t){this.canvas.width=window.innerWidth,this.canvas.height=this.contextHeight=window.innerHeight-t-20}},{key:"addNote",value:function(t,e,i){var n={x:parseFloat(e),y:0,width:parseFloat(i),height:0,color:c.COLORS[t],on:!0};return this.notes.push(n),n}},{key:"stopNote",value:function(t){t.on=!1}},{key:"drawLoop",value:function(){var e=this;this.context.clearRect(0,0,window.innerWidth,window.innerHeight),this.notes=this.notes.filter(function(t){return t.on||t.y<e.contextHeight-100});for(var t=0;t<this.notes.length;t++){var i=this.notes[t];i.on?i.height+=3:i.y+=3,this.context.globalAlpha=1-i.y/this.contextHeight,this.context.fillStyle=i.color,this.context.fillRect(i.x,i.y,i.width,i.height)}window.requestAnimationFrame(function(){return e.drawLoop()})}}]),t}(),u=function(){function t(){n(this,t),this.config={whiteNoteWidth:20,blackNoteWidth:20,whiteNoteHeight:70,blackNoteHeight:140/3},this.svg=document.getElementById("svg"),this.svgNS="http://www.w3.org/2000/svg"}return r(t,[{key:"resize",value:function(t){var e=window.innerWidth/t;this.config.whiteNoteWidth=6<m?e:Math.floor(e),this.config.blackNoteWidth=2*this.config.whiteNoteWidth/3,this.svg.setAttribute("width",window.innerWidth),this.svg.setAttribute("height",this.config.whiteNoteHeight)}},{key:"draw",value:function(){this.svg.innerHTML="";var t=this.config.blackNoteWidth/2,e=0,i=0,n=[1,3,6,8,10];6<m?(this.makeRect(0,e,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),this.makeRect(2,this.config.whiteNoteWidth,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),i=3,e=2*this.config.whiteNoteWidth):i=3+c.NOTES_PER_OCTAVE;for(var o=0;o<m;o++)for(var r=0;r<c.NOTES_PER_OCTAVE;r++)-1===n.indexOf(r)&&(this.makeRect(i,e,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),e+=this.config.whiteNoteWidth),i++;e=6<m?(this.makeRect(i,e,0,this.config.whiteNoteWidth,this.config.whiteNoteHeight,"white","#141E30"),this.makeRect(1,this.config.whiteNoteWidth-t,0,this.config.blackNoteWidth,this.config.blackNoteHeight,"black"),i=3,this.config.whiteNoteWidth):(i=3+c.NOTES_PER_OCTAVE,-this.config.whiteNoteWidth);for(var s=0;s<m;s++)for(var a=0;a<c.NOTES_PER_OCTAVE;a++)-1!==n.indexOf(a)?this.makeRect(i,e+this.config.whiteNoteWidth-t,0,this.config.blackNoteWidth,this.config.blackNoteHeight,"black"):e+=this.config.whiteNoteWidth,i++}},{key:"highlightNote",value:function(t,e){var i=this.svg.querySelector('rect[data-index="'.concat(t,'"]'));if(i)return i.setAttribute("active",!0),i.setAttribute("class","color-".concat(e)),i;console.log("couldnt find a rect for note",t)}},{key:"clearNote",value:function(t){t.removeAttribute("active"),t.removeAttribute("class")}},{key:"makeRect",value:function(t,e,i,n,o,r,s){var a=document.createElementNS(this.svgNS,"rect");return a.setAttribute("data-index",t),a.setAttribute("x",e),a.setAttribute("y",i),a.setAttribute("width",n),a.setAttribute("height",o),a.setAttribute("fill",r),s&&(a.setAttribute("stroke",s),a.setAttribute("stroke-width","3px")),this.svg.appendChild(a),a}}]),t}(),h={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7},l={0:0,1:2,2:5,3:7},f=["a","s","d","f","j","k","l",";"],g=["ArrowUp","ArrowLeft","ArrowDown","ArrowRight","w","a","s","d"],v=["↑","←","↓","→","w","a","s","d"],m=7,E=8,w=h,p=D(),N=new Map,y=!1,O=[],I=null,k=new a,A=new mm.PianoGenie(c.GENIE_CHECKPOINT),b=new d,_=new u,M=!1;function T(t){E=t;var e=document.querySelectorAll(".controls > button.color");w=4===t?l:h;for(var i=0;i<e.length;i++)e[i].hidden=t<=i}function x(t){t.preventDefault(),I=t.target,W(t.target.dataset.id)}function L(t){t.preventDefault(),I&&I!==t.target&&P(I.dataset.id),I=null,P(t.target.dataset.id)}function S(t,e){I&&(e?W(t.target.dataset.id):P(t.target.dataset.id))}function W(t){var e,i,n,o,r;N.has(t)||(e=document.getElementById("btn".concat(t)))&&(e.setAttribute("active",!0),i=A.nextFromKeyWhitelist(w[t],s,p),n=c.LOWEST_PIANO_KEY_MIDI_NOTE+i,k.playNoteDown(n,t),o=_.highlightNote(i,t),r=b.addNote(t,o.getAttribute("x"),o.getAttribute("width")),N.set(t,{rect:o,note:i,noteToPaint:r}))}function P(t){var e,i,n=document.getElementById("btn".concat(t));n&&(n.removeAttribute("active"),(e=N.get(t))&&(_.clearNote(e.rect),b.stopNote(e.noteToPaint),i=c.LOWEST_PIANO_KEY_MIDI_NOTE+e.note,y?O.push(c.LOWEST_PIANO_KEY_MIDI_NOTE+e.note):k.playNoteUp(i,t)),N.delete(t))}function H(t){var e;t.repeat||(" "===t.key?y=!0:"0"===t.key||"r"===t.key?(console.log("🧞‍♀️ resetting!"),A.resetState()):null!=(e=B(t.key))&&W(e))}function R(t){var e;" "===t.key?(y=!1,O.forEach(function(t){return k.playNoteUp(t,-1)}),O=[]):null!=(e=B(t.key))&&P(e)}function C(){var t=6<(m=700<window.innerWidth?7:3)?4:0,e=c.NOTES_PER_OCTAVE*m+t,i=c.WHITE_NOTES_PER_OCTAVE*m+(t-1);s=Array(e).fill().map(function(t,e){return 6<m?e:e+3+c.NOTES_PER_OCTAVE}),_.resize(i),b.resize(_.config.whiteNoteHeight),_.draw()}function B(t){if("1"<=t&&t<=String(E))return parseInt(t)-1;var e=M?g.indexOf(t):f.indexOf(t);return-1!==e?e:null}function D(){var t,i,e=parseFloat((t=window.location.hash.substring(1),i={},t.split("&").map(function(t){var e=t.split("=");i[e[0]]=e[1]}),i).temperature)||.25,n=Math.min(1,e);return console.log("🧞‍♀️ temperature = ",n),n}function q(){for(var t=document.querySelectorAll(".controls button.color"),e=0;e<t.length;e++)t[e].innerHTML=M?"<span>".concat(v[e],"</span>"):"<span>".concat(e+1,"</span><br><span>").concat(f[e],"</span>")}A.initialize().then(function(){console.log("🧞‍♀️ ready!"),playBtn.textContent="Play",playBtn.removeAttribute("disabled"),playBtn.classList.remove("loading")}),C(),q(),window.requestAnimationFrame(function(){return b.drawLoop()}),document.getElementById("numButtons4").addEventListener("change",function(t){return t.target.checked&&T(4)}),document.getElementById("numButtons8").addEventListener("change",function(t){return t.target.checked&&T(8)}),window.addEventListener("resize",C),window.addEventListener("orientationchange",C),window.addEventListener("hashchange",function(){return p=D()})},{}]},{},[1]);
//# sourceMappingURL=bundle.min.js.map
